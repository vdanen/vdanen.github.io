<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="raid, Macos, " />

<meta property="og:title" content="Adventures in AppleRAID "/>
<meta property="og:url" content="https://vdanen.github.io/blog/adventures-in-appleraid.html" />
<meta property="og:description" content="Actually, it&#39;s not much of an adventure so much as a reminder. I&#39;m used to doing software RAID on Linux with mdadm and am fully comfortable with the commandline tools -- in fact, I prefer them to any GUI tools that may or may not be out there (for example, if …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2013-12-07T21:00:00-07:00" />
<meta name="twitter:title" content="Adventures in AppleRAID ">
<meta name="twitter:description" content="Actually, it&#39;s not much of an adventure so much as a reminder. I&#39;m used to doing software RAID on Linux with mdadm and am fully comfortable with the commandline tools -- in fact, I prefer them to any GUI tools that may or may not be out there (for example, if …">

        <title>Adventures in AppleRAID  · Annvix
</title>
        <link href="https://vdanen.github.io/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://vdanen.github.io/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://vdanen.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://vdanen.github.io/about.html">About</a></li>
                                <li ><a href="https://vdanen.github.io/documentation.html">Documentation</a></li>
                                <li ><a href="https://vdanen.github.io/categories.html">Categories</a></li>
                                <li ><a href="https://vdanen.github.io/tags.html">Tags</a></li>
                                <li ><a href="https://vdanen.github.io/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://vdanen.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://vdanen.github.io/blog/adventures-in-appleraid.html">
                Adventures in AppleRAID
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Actually, it's not much of an adventure so much as a reminder.  I'm used to doing software RAID on Linux with mdadm and am fully comfortable with the commandline tools -- in fact, I prefer them to any GUI tools that may or may not be out there (for example, if I were to have a choice of using mdadm on the commandline versus using Anaconda to setup a RAID array, I would take the commandline).</p>
<p>Anyways, I use Apple's software RAID on OS X as well.  With mdadm I'm fully confident.  With Apple RAID I'm not as much, primarily because I've not had the opportunity to put it through it's paces, and also because Disk Utility is absolutely horrendous for dealing with setting the RAID arrays up.</p>
<p>Anyways, I was unlucky enough in mid-2012 to buy a few of those Seagate drives that chirped.  Harmless, once I realized the drives were not going to die, but annoying nonetheless.  Suffice it to say, I've gotten used to it.  Anyways, 3TB drives are $130CAD a piece now which is pretty cheap, and these drives have been running for the last year and a half pretty much non-stop.  Between price, requiring some larger drives as offline archives (to which use I can put these chirpy drives), and really feeling like I should test the Apple RAID (last test I believe was in 10.7 and now the system is running 10.9), I figured it was a good time to give it a go.</p>
<p>Simple procedure: shut down the computer, pull out one drive, pop in a new drive, fire it back up.  Because I have a RAID0+1 (so three RAID arrays, two RAID mirrors and one RAID stripe), I could pull two drives, one from each mirror array, and rebuild two at a time but I prefer to be cautious.</p>
<p>Upon bootup I get the "you've inserted an uninitialized disk" notice (to which I tell it to ignore the drive), get a happy degraded RAID warning from SMARTReporter, and am ready to get it back up and running.  The required commands are surprisingly simple:</p>
<pre>
% <b>sudo diskutil list</b>
Password:
/dev/disk0
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *512.1 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:                  Apple_HFS fenris                  511.3 GB   disk0s2
   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3
<b>/dev/disk1
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:                                                   *3.0 TB     disk1</b>
/dev/disk2
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *3.0 TB     disk2
   1:                        EFI EFI                     209.7 MB   disk2s1
   2:                 Apple_RAID                         3.0 TB     disk2s2
   3:                 Apple_Boot Boot OS X               134.2 MB   disk2s3
/dev/disk3
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *3.0 TB     disk3
   1:                        EFI EFI                     209.7 MB   disk3s1
   2:                 Apple_RAID                         3.0 TB     disk3s2
   3:                 Apple_Boot Boot OS X               134.2 MB   disk3s3
/dev/disk4
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *3.0 TB     disk4
   1:                        EFI EFI                     209.7 MB   disk4s1
   2:                 Apple_RAID                         3.0 TB     disk4s2
   3:                 Apple_Boot Boot OS X               134.2 MB   disk4s3
/dev/disk5
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *3.0 TB     disk5
   1:                        EFI EFI                     209.7 MB   disk5s1
   2:                  Apple_HFS G-DRIVE                 3.0 TB     disk5s2
/dev/disk6
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:                  Apple_HFS Stuff                  *6.0 TB     disk6
</pre>

<p>In this case, we've removed the first physical drive in the Mac Pro's four bays (I have an SSD as a boot device in there as disk0), so it's disk1 we're interested in.  Make a note of the disk identifier (the one with no partitions on it).</p>
<p>Next we want to see what our RAID information looks like because we need to know which array this drive needs to be added to, and we need to know the unique identifer (UUID) of the RAID array:</p>
<pre>
% <b>sudo diskutil appleraid list</b>
AppleRAID sets (3 found)
===============================================================================
Name:                 Stuff_1
Unique ID:            A50AAB2A-D2DE-44DD-BAF0-7577072C5937
Type:                 Mirror
Status:               Online
Size:                 3.0 TB (3000248958976 Bytes)
Rebuild:              automatic
Device Node:          -
-------------------------------------------------------------------------------
#  DevNode   UUID                                  Status     Size
-------------------------------------------------------------------------------
0  disk2s2   3BF8BC8C-CE09-447C-8A86-ED51E8515C3E  Online     3000248958976
1  disk3s2   A117C08C-B375-469C-A654-EAA902E5A317  Online     3000248958976
===============================================================================
===============================================================================
Name:                 Stuff
Unique ID:            F2429656-695B-4F8C-B870-B7334DC3340D
Type:                 Stripe
Status:               Online
Size:                 6.0 TB (6000497786880 Bytes)
Rebuild:              manual
Device Node:          disk6
-------------------------------------------------------------------------------
#  DevNode   UUID                                  Status     Size
-------------------------------------------------------------------------------
0  -none-    C96F3052-8EBD-45D5-9A25-29EE23957CA9  Online     3000248893440
1  -none-    A50AAB2A-D2DE-44DD-BAF0-7577072C5937  Online     3000248893440
===============================================================================
===============================================================================
Name:                 Stuff_2
Unique ID:            <b>C96F3052-8EBD-45D5-9A25-29EE23957CA9</b>
Type:                 Mirror
Status:               <b>Degraded</b>
Size:                 3.0 TB (3000248958976 Bytes)
Rebuild:              automatic
Device Node:          -
-------------------------------------------------------------------------------
#  DevNode   UUID                                  Status     Size
-------------------------------------------------------------------------------
<b>-  -none-    F3921C5D-0B94-4264-9619-0291A5147F4E  Missing/Damaged</b>
1  disk4s2   12511D3B-A21C-4BB7-B68B-DAA5E2AC0277  Online     3000248958976
===============================================================================
</pre>

<p>There's a few bits of info here.  The first is the uuid of our RAID mirror that it's in a degraded state (the RAID volume name is Stuff_2, above, with the uuid noted below the name).  The second bit of information we need is the uuid of the <i>failed</i> drive (in this case, the drive I removed).  We will need to remove this missing device from the array after we add the new one.</p>
<pre>
% <b>sudo diskutil appleraid add member disk1 C96F3052-8EBD-45D5-9A25-29EE23957CA9</b>
Started RAID operation
Unmounting disk
Repartitioning disk1 so it can be in a RAID set
Unmounting disk
Creating the partition map
Adding disk1s2 to the RAID Set
Finished RAID operation
% <b>sudo diskutil appleraid list</b>
AppleRAID sets (3 found)
===============================================================================
Name:                 Stuff_1
Unique ID:            A50AAB2A-D2DE-44DD-BAF0-7577072C5937
Type:                 Mirror
Status:               Online
Size:                 3.0 TB (3000248958976 Bytes)
Rebuild:              automatic
Device Node:          -
-------------------------------------------------------------------------------
#  DevNode   UUID                                  Status     Size
-------------------------------------------------------------------------------
0  disk2s2   3BF8BC8C-CE09-447C-8A86-ED51E8515C3E  Online     3000248958976
1  disk3s2   A117C08C-B375-469C-A654-EAA902E5A317  Online     3000248958976
===============================================================================
===============================================================================
Name:                 Stuff
Unique ID:            F2429656-695B-4F8C-B870-B7334DC3340D
Type:                 Stripe
Status:               Online
Size:                 6.0 TB (6000497786880 Bytes)
Rebuild:              manual
Device Node:          disk6
-------------------------------------------------------------------------------
#  DevNode   UUID                                  Status     Size
-------------------------------------------------------------------------------
0  -none-    C96F3052-8EBD-45D5-9A25-29EE23957CA9  Online     3000248893440
1  -none-    A50AAB2A-D2DE-44DD-BAF0-7577072C5937  Online     3000248893440
===============================================================================
===============================================================================
Name:                 Stuff_2
Unique ID:            C96F3052-8EBD-45D5-9A25-29EE23957CA9
Type:                 Mirror
Status:               Degraded
Size:                 3.0 TB (3000248958976 Bytes)
Rebuild:              automatic
Device Node:          -
-------------------------------------------------------------------------------
#  DevNode   UUID                                  Status     Size
-------------------------------------------------------------------------------
-  -none-    F3921C5D-0B94-4264-9619-0291A5147F4E  Missing/Damaged
1  disk4s2   12511D3B-A21C-4BB7-B68B-DAA5E2AC0277  Online     3000248958976
<b>2  disk1s2   6A381F4D-759C-4CFB-BB38-1EA22C7D58B8  0% (Rebuilding)3000248958976</b>
===============================================================================
</pre>

<p>Or, <b>sudo diskutil appleraid add member disk# [uuid-of-raid]</b>
As you can see from the above, we added the new drive (disk1) to the RAID array named Stuff_2.  And after we did so, performed another list operation, and you can see three drives associated with that array -- one is online, one is missing, and one is rebuilding.  Now we need to remove the missing one as we won't be adding it back:</p>
<pre>
% <b>sudo diskutil appleraid remove F3921C5D-0B94-4264-9619-0291A5147F4E C96F3052-8EBD-45D5-9A25-29EE23957CA9</b>
Started RAID operation
Removing disk from RAID
Finished RAID operation
</pre>

<p>Or, <b>sudo diskutil appleraid remove [uuid-of-failed-drive] [uuid-of-raid]</b>.</p>
<p>And that's it.  Honestly, it took me longer to type this out than it did to rebuild the RAID array.  Sadly, in that time it's only progressed to 3% rebuilt.  The downside of such large drives is the reconstruction time is a little ridiculous.  Anyways, once you've run these commands in Terminal, if you were to fire up Disk Utility, you'd see a nice little GUI progress bar that, for me, indicates it will take 4hrs to rebuild.</p>
<p>Honestly, for anyone who has fought with Disk Utility to manage anything RAID in OS X, you'll appreciate how simple the diskutil commandline tool makes things.</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2013-12-07T21:00:00-07:00">Sat 07 December 2013</time>
            <h4>Category</h4>
            <a class="category-link" href="https://vdanen.github.io/categories.html#macos-ref">Macos</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://vdanen.github.io/tags.html#raid-ref">raid
                    <span class="superscript">4</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://twitter.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://github.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/vdanen/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://infosec.exchange/@vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mastodon" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%"/><path d="m409 290c-5 24-43 50-85 56-86 11-137-6-137-6 3 13-4 54 70 52 31 0 58-7 58-7l2 27c-51 24-107 15-140 6-67-17-79-90-81-162v-59c0-74 49-96 49-96 50-24 180-22 222 0 0 0 49 22 49 96 0 0 1 55-7 93" fill="#3088d4"/><path d="m358 202v91h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://vdanen.github.io/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>