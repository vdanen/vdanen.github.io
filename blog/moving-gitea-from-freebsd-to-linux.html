<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/custom.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/fontawesome.min.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta name="description" content="I‚Äôve been using TrueNAS for a number of years, from when it was FreeBSD-based to now that it‚Äôs Linux-based. Right now I use them both: TrueNAS Core (FreeBD) and TrueNAS Scale (Linux). The TrueNAS Scale box has been mostly for fiddling with containers, while the TrueNAS Core box ‚Ä¶
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="linux, truenas, freebsd, gitea, git, alpine, Linux, " />

<meta property="og:title" content="Moving Gitea from FreeBSD to¬†Linux "/>
<meta property="og:url" content="https://annvix.com/blog/moving-gitea-from-freebsd-to-linux" />
<meta property="og:description" content="I‚Äôve been using TrueNAS for a number of years, from when it was FreeBSD-based to now that it‚Äôs Linux-based. Right now I use them both: TrueNAS Core (FreeBD) and TrueNAS Scale (Linux). The TrueNAS Scale box has been mostly for fiddling with containers, while the TrueNAS Core box ‚Ä¶" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2025-11-18T18:04:00-07:00" />
<meta name="twitter:title" content="Moving Gitea from FreeBSD to¬†Linux ">
<meta name="twitter:description" content="I‚Äôve been using TrueNAS for a number of years, from when it was FreeBSD-based to now that it‚Äôs Linux-based. Right now I use them both: TrueNAS Core (FreeBD) and TrueNAS Scale (Linux). The TrueNAS Scale box has been mostly for fiddling with containers, while the TrueNAS Core box ‚Ä¶">

        <title>Moving Gitea from FreeBSD to¬†Linux  ¬∑ Annvix
</title>
        <link rel="shortcut icon" href="https://annvix.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://annvix.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://annvix.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://annvix.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://annvix.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://annvix.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://annvix.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://annvix.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://annvix.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://annvix.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://annvix.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://annvix.com/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5JGVD90SKJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5JGVD90SKJ');
</script>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://annvix.com/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://annvix.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://annvix.com/categories">Categories</a></li>
                                <li ><a href="https://annvix.com/tags">Tags</a></li>
                                <li ><a href="https://annvix.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://annvix.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://annvix.com/blog/moving-gitea-from-freebsd-to-linux">
                Moving Gitea from FreeBSD to&nbsp;Linux
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>I&#8217;ve been using <a href="https://www.truenas.com/">TrueNAS</a> for a number of years, from when it was FreeBSD-based to now that it&#8217;s Linux-based.  Right now I use them both: TrueNAS Core (FreeBD) and TrueNAS Scale (Linux).  The TrueNAS Scale box has been mostly for fiddling with containers, while the TrueNAS Core box is the heavy lifter: all of my <a href="https://bombich.com/">Carbon Copy Cloner</a> backups go there, and there are FreeBSD jails running my <a href="https://www.plex.tv/">Plex</a> server as weill as my <a href="https://about.gitea.com/">Gitea</a>&nbsp;server.</p>
<p>Now that the FreeBSD-based version is getting long in the tooth and will soon be unsupported (FreeBSD 13, which it&#8217;s based on will be end of life in January 2026), I&#8217;ve been thinking about upgrading that box to Scale for the last year.  TrueNAS (supposedly) makes it easy to convert the running system from FreeBSD to Linux, but I&#8217;ve not tried it yet.  I need to move my Plex server and Gitea server over first, so this past weekend I took the plunge.  Now, TrueNAS does a lot with containers so at first I was thinking of using containers for this but&#8230; and I&#8217;m going to be honest here, TrueNAS has burnt me a few times with community containers.  I don&#8217;t even remember how many times I had to redo my <a href="https://pi-hole.net/">Pi-hole</a> container because things just&#8230; broke.  It got so annoying that I eventually bought a Raspberry Pi to run Pi-hole and left the containerized thing behind me.  Gitea, and Plex, are pretty critical to my daily workflows (well, Plex is critical to my wife&#8217;s daily workflow anyways üòâ), so trusting them to the world of containers is not something I&#8217;m prepared to do at this time.  So I opted for a virtual machine, but wanted something as light as possible to get the same performance efficiencies I was getting out of my FreeBSD&nbsp;jails.</p>
<p>Enter <a href="https://www.alpinelinux.org/">Alpine Linux</a> &#8212; a distro I&#8217;ve never installed before but ended up being pleasantly surprised&nbsp;with!</p>
<p>So this was the challenge: setup a new Alpine Linux <span class="caps">VM</span> on TrueNAS Scale, backup the FreeBSD-based Gitea and restore it, on Linux, in the new virtual machine and then transparently swap the two.  And the bonus challenge: <em>Alpine&#8217;s community repo provided Gitea 1.23.8 and I was running 1.24.2 on FreeBSD</em>.</p>
<p>The tl;dr is it worked.  But it <em>took</em> some work.  Read on if interested&#8230; this is mostly for myself as I expect few people to be as hackish (dare I say: reckless?) as me when it comes to this but hey, you never&nbsp;know!</p>
<h2 id="installing-alpine-linux">Installing Alpine Linux<a class="headerlink" href="#installing-alpine-linux" title="Permanent link"> </a></h2>
<p>The first step was to setup the virtual machine and install Alpine.  Word to the wise: see how much space you are using <em>before</em> you create the virtual machine!  For some reason, I assumed <span class="caps">30GB</span> for the virtual machine would be enough space.  With FreeBSD jails I never had to worry about the amount of available space, it had access to the entire storage pool, which was about <span class="caps">18TB</span>.  Suffice it to say, I didn&#8217;t check, and the Gitea backup zip (which was <span class="caps">34GB</span>) quickly exceeded the space I had allocated.  Recreation of the virtual machine was&nbsp;required.</p>
<p>This virtual machine has one very specific purpose: to host my git repos.  But to do that, more than what Alpine itself provided out of the box was required; in this case the <a href="https://www.alpinelinux.org/downloads/">virtual</a> <span class="caps">ISO</span> was chosen, which is Alpine optimized for virtual machines.  Setting up virtual machines in TrueNAS is left as an exercise to the reader &#8212; nothing really special&nbsp;there.</p>
<p>Upon completion of the install and subsequent reboot, the community repos needed to be enabled by uncommenting the &#8220;community&#8221; line, as the root&nbsp;user:</p>
<div class="highlight"><pre><span></span>vi<span class="w"> </span>/etc/apk/repositories
apk<span class="w"> </span>update
</pre></div>


<p>Additional software needs to be installed, and some of these are preferences, like sudo and vim, while others were needed by Gitea.  MySQL was used on FreeBSD, so MariaDB needed to be installed.  After installing sudo, given that my user was in the <code>wheel</code> group, it needed to be added to <code>/etc/sudoers</code> to ensure appropriate access was granted, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>apk<span class="w"> </span>add<span class="w"> </span>sudo<span class="w"> </span>vim
visudo
</pre></div>


<h2 id="installing-mariadb">Installing MariaDB<a class="headerlink" href="#installing-mariadb" title="Permanent link"> </a></h2>
<p>At this point, everything could be done with sudo rather than directly as root, so to install MariaDB as my regular&nbsp;user:</p>
<div class="highlight"><pre><span></span>sudo<span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>mariadb<span class="w"> </span>mariadb-client
sudo<span class="w"> </span>mariadb-install-db<span class="w"> </span>--user<span class="o">=</span>mysql<span class="w"> </span>--datadir<span class="o">=</span>/var/lib/mysql
sudo<span class="w"> </span>rc-service<span class="w"> </span>mariadb<span class="w"> </span>start
</pre></div>


<p>That said, typing sudo quickly got boring so a running <code>sudo su -</code> to become root and finish things off.  Most of the subsequent commands, unless noted otherwise, are run as root.  Yes, I do security for a living and no, I don&#8217;t care about running amuck as root on a fresh system not exposed to the internet.  <span class="caps">YOLO</span> (as the kids&nbsp;say)!</p>
<p>The next step was to secure and start MariaDB, securely create <code>~root/.mysql_secret</code> and paste the chosen root password for MariaDB in it, then start it and ensure it starts on every boot, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>mariadb-secure-installation
touch<span class="w"> </span>~root/.mysql_secret
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~root/.mysql_secret
vim<span class="w"> </span>~root/.mysql_secret
rc-service<span class="w"> </span>mariadb<span class="w"> </span>restart
rc-update<span class="w"> </span>add<span class="w"> </span>mariadb<span class="w"> </span>default
</pre></div>


<p>On the FreeBSD server, dumping the MySQL database directly, rather than relying on the Gitea backup, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>mysqldump<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span>gitea<span class="w"> </span>&gt;<span class="w"> </span>~/gitea-db.sql
</pre></div>


<p>The <code>gitea-db.sql</code> file was copied from the FreeBSD jail to the Linux virtual machine for importing into MariaDB.  At this point, MariaDB was insisting that &#8220;<span class="caps">BINLOG</span> <span class="caps">ADMIN</span>&#8221; privileges needed to be granted to the gitea user that was created to own the Gitea database.  The error it spit out was: <strong>&#8220;<span class="caps">ERROR</span> 1193 (<span class="caps">HY000</span>): Unknown system variable &#8216;GTID_PURGED&#8217;&#8221;</strong>.  It ended up being easily fixed by commenting out the &#8220;<span class="caps">GLOBAL</span>.GTID_PURGED&#8221; comment in the database dump (thanks <a href="https://stackoverflow.com/questions/45858723/error-1193-hy000-unknown-system-variable-gtid-purged">StackOverflow</a>).  Now it could be imported, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>mariadb<span class="w"> </span>--default-character-set<span class="o">=</span>utf8mb4<span class="w"> </span>-u<span class="w"> </span>gitea<span class="w"> </span>-p<span class="w"> </span>gitea<span class="w"> </span>&lt;gitea-db.sql
</pre></div>


<h2 id="installing-gitea">Installing Gitea<a class="headerlink" href="#installing-gitea" title="Permanent link"> </a></h2>
<p>Now began the trial and error of getting Gitea installed, setup, and seeing if it could be made to work.  Obviously we need to install Gitea itself, which the Alpine community repo provides.  This was a deliberate choice, as it would have provided the appropriate init scripts and being unfamiliar with Alpine, I didn&#8217;t want to have to figure it out &#8212; it&#8217;s been quite some time since I&#8217;ve fiddled with SysV-init!  Additionally, at some point being aligned with what Alpine provided was a goal, so this was a hack to get things moved over now, rather than at some point in the future.  As&nbsp;root:</p>
<div class="highlight"><pre><span></span>apk<span class="w"> </span>add<span class="w"> </span>gitea
</pre></div>


<p>At the time of this adventure, what was provided by Alpine was Gitea 1.23.8 and what was in my FreeBSD jail was 1.24.2.  This is important to remember as it explains some of the madness later.  There is a <a href="https://docs.gitea.com/administration/backup-and-restore">backup and restore</a> document to follow indicating how to make the backup, and how to restore.  Simple and&nbsp;straightforward.</p>
<p>Until it wasn&#8217;t, because an annoyance quickly arose: unzip kept spitting out a <strong>&#8220;unzip: short read&#8221;</strong> error on my backup when trying to unzip it.  At first I thought maybe due to the size there was some network-based corruption, so used rsync to copy it again to be sure &#8212; no dice, the same problem occurred.  With a little hunting, it seems the unzip that came with BusyBox (which Alpine uses) might not be able to handle such large (<span class="caps">34GB</span>) zip files, but the <em>real</em> unzip could, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>apk<span class="w"> </span>add<span class="w"> </span>unzip
unzip<span class="w"> </span>gitea-backup-dump.zip
</pre></div>


<p>This started to work, but then failed with an <strong>&#8220;error: invalid zip file with overlapped components (possible zip bomb)&#8221;</strong> error.. sigh.  So doing the rationale and safe thing, as&nbsp;root:</p>
<div class="highlight"><pre><span></span><span class="nv">UNZIP_DISABLE_ZIPBOMB_DETECTION</span><span class="o">=</span>TRUE<span class="w"> </span>unzip<span class="w"> </span>gitea-backup-dump.zip
</pre></div>


<p>Remember kids, this is not the sort of stuff you want to run in production!  Fortunately, my existing Gitea server was still running and if this thing went sideways.. well, that&#8217;s what all the notes are for.&nbsp;üòâ</p>
<p>This time it unzipped properly and could start moving files around, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>mv<span class="w"> </span>/etc/gitea/app.ini<span class="w"> </span>/etc/gitea/app.ini.org
cp<span class="w"> </span>app.ini<span class="w"> </span>/etc/gitea/
mv<span class="w"> </span>data/*<span class="w"> </span>/var/lib/gitea/data/
mv<span class="w"> </span>log/*<span class="w"> </span>/var/log/gitea/
mkdir<span class="w"> </span>/var/lib/gitea/git
mv<span class="w"> </span>repos/*<span class="w"> </span>/var/lib/gitea/git/
</pre></div>


<p>On the FreeBSD setup, the user and group for Gitea was the <code>git</code> user.  On Alpine&#8217;s install the user is <code>gitea</code> and the group is <code>www-data</code> so there were some permissions that needed to be adjusted, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>chown<span class="w"> </span>-R<span class="w"> </span>gitea:www-data<span class="w"> </span>/etc/gitea<span class="w"> </span>/var/lib/gitea<span class="w"> </span>/var/log/gitea/
</pre></div>


<p>One thing to note: the path layouts are quite different, so the Gitea <code>app.ini</code> configuration file needed to be adjusted to the new paths.  In most cases this was just changing <code>/var/db/gitea</code> to <code>/var/lib/gitea</code> and the user for the <strong>RUN_AS</strong> option had to be changed from <code>git</code> to <code>gitea</code> as&nbsp;well.</p>
<p>Next, the ssh keys stored in <code>/usr/local/git/.ssh</code> in the FreeBSD jail had to be copied over to <code>/var/lib/gitea/.ssh</code> in the Linux virtual machine.  These need to be corrected by running, as the gitea&nbsp;user:</p>
<div class="highlight"><pre><span></span>gitea<span class="w"> </span>admin<span class="w"> </span>regenerate<span class="w"> </span>keys
</pre></div>


<p>There were a lot of frequent uses of the <code>gitea doctor check</code> command to clear up any errors, but it was all quite self-explanatory; note these all need to be run by the gitea user as it really doesn&#8217;t like to be executed as root (for probably very good reasons).  The one error that kept coming up was the mismatched database version, which wasn&#8217;t a surprise but at that time, the workaround remained a mystery.  Gitea refused to start because the database was versioned with a newer version of Gitea than was&nbsp;installed:</p>
<div class="highlight"><pre><span></span><span class="mi">2025</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">16</span> <span class="mi">08</span>:<span class="mi">25</span>:<span class="mi">28</span> <span class="n">cmd</span><span class="o">/</span><span class="n">web</span>.<span class="n">go:205:serveInstalled</span>() [<span class="n">I</span>] <span class="n">PING</span> <span class="n">DATABASE</span> <span class="n">mysql</span>
<span class="mi">2025</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">16</span> <span class="mi">08</span>:<span class="mi">25</span>:<span class="mi">28</span> ...<span class="n">dels</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">collation</span>.<span class="n">go:185:preprocessDatabaseCollation</span>() [<span class="n">W</span>] <span class="n">Current</span> <span class="n">database</span> <span class="k">is</span> <span class="n">using</span> <span class="n">a</span> <span class="n">case-insensitive</span> <span class="n">collation</span> <span class="s">&quot;utf8mb4_general_ci&quot;</span>, <span class="n">although</span> <span class="n">Gitea</span> <span class="n">could</span> <span class="n">work</span> <span class="k">with</span> <span class="n">it</span>, <span class="n">there</span> <span class="n">might</span> <span class="n">be</span> <span class="n">some</span> <span class="n">rare</span> <span class="n">cases</span> <span class="n">which</span> <span class="n">don&#39;t</span> <span class="n">work</span> <span class="n">as</span> <span class="nb">expected</span>.
<span class="mi">2025</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">16</span> <span class="mi">08</span>:<span class="mi">25</span>:<span class="mi">28</span> ...<span class="n">ations</span><span class="o">/</span><span class="n">migrations</span>.<span class="n">go:481:Migrate</span>() [<span class="n">F</span>] <span class="n">Migration</span> <span class="n">Error:</span> <span class="n">Your</span> <span class="n">database</span> (<span class="n">migration</span> <span class="n">version:</span> <span class="mi">321</span>) <span class="k">is</span> <span class="k">for</span> <span class="n">a</span> <span class="n">newer</span> <span class="n">Gitea</span>, <span class="n">you</span> <span class="nb">can</span> <span class="nb">not</span> <span class="k">use</span> <span class="n">the</span> <span class="n">newer</span> <span class="n">database</span> <span class="k">for</span> <span class="n">this</span> <span class="nb">old</span> <span class="n">Gitea</span> <span class="nb">release</span> (<span class="mi">312</span>).
<span class="n">Gitea</span> <span class="n">will</span> <span class="nb">exit</span> <span class="nb">to</span> <span class="nb">keep</span> <span class="n">your</span> <span class="n">database</span> <span class="n">safe</span> <span class="o">and</span> <span class="n">unchanged</span>. <span class="n">Please</span> <span class="k">use</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">Gitea</span> <span class="nb">release</span>, <span class="nb">do</span> <span class="nb">not</span> <span class="n">change</span> <span class="n">the</span> <span class="n">migration</span> <span class="nb">version</span> <span class="n">manually</span> (<span class="n">incorrect</span> <span class="n">manual</span> <span class="nb">operation</span> <span class="n">may</span> <span class="n">lose</span> <span class="n">data</span>).
</pre></div>


<p>Disappointing, but not surprising.  Also not something that was about to deter me and my enjoyable Sunday afternoon sitting on the couch fiddling with this stuff.  This was a proper adventure the likes of which I don&#8217;t often get to&nbsp;enjoy!</p>
<p>And here&#8217;s where I decided to take the plunge: I could hold off my upgrade desires until Alpine&#8217;s community repo provided the right version of Gitea, or could I go out on a limb and grab the binary from upstream and replace what was on-disk.  My thinking was: it&#8217;s a blob of Go, pretty self-contained, and the download is literally a versioned Gitea binary.  What&#8217;s the worst that could&nbsp;happen?</p>
<p>So I downloaded the <a href="https://dl.gitea.com/gitea/1.24.2/">1.24.2 version from upstream</a> which matched the version that was running on FreeBSD.  Slightly unorthodox, as this still an experiment and my intention, if this worked, was to ride it out until the Alpine community repo provided the right version, so I downloaded it to <code>/etc/gitea/</code> and just&#8230; changed the binary, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>mv<span class="w"> </span>/usr/bin/gitea<span class="w"> </span>/usr/bin/gitea-1.23.8
ln<span class="w"> </span>-s<span class="w"> </span>/etc/gitea/gitea-1.24.2-linux-amd64<span class="w"> </span>/usr/bin/gitea
<span class="nv">GITEA_WORK_DIR</span><span class="o">=</span>/var/lib/gitea<span class="w"> </span>gitea
</pre></div>


<p>Surprisingly, it worked.  Well, thus far anyways.  No errors!  And the web interface runs as well, although granted it can&#8217;t be connected to yet as it&#8217;s listening to a <span class="caps">UNIX</span> socket, but the fact that it starts without complaint is pretty impressive, as the gitea&nbsp;user:</p>
<div class="highlight"><pre><span></span><span class="nv">GITEA_WORK_DIR</span><span class="o">=</span>/var/lib/gitea<span class="w"> </span>gitea<span class="w"> </span>web<span class="w"> </span>-c<span class="w"> </span>/etc/gitea/app.ini
</pre></div>


<h2 id="installing-nginx">Installing nginx<a class="headerlink" href="#installing-nginx" title="Permanent link"> </a></h2>
<p>Gitea needs a proxy web server running in front of it, and my prior install used nginx so it made sense to use the same thing here.  The contents of <code>/usr/local/etc/nginx/nginx.conf</code> on the FreeBSD setup were copied to <code>/etc/nginx/httpd.d/default.conf</code>.  The important piece is to ensure that the <strong>proxy_pass</strong> configuration directive in nginx&#8217;s <code>default.conf</code> is the same as that in Gitea&#8217;s <code>app.ini</code>.</p>
<p>That said, now Let&#8217;s Encrypt is required because <span class="caps">SSL</span> is important.  Because my Gitea server is not accessible via the internet, <span class="caps">DNS</span> must used for verification, so a few things needed to be installed, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>apk<span class="w"> </span>add<span class="w"> </span>certbot<span class="w"> </span>certbot-nginx<span class="w"> </span>certbot-dns
</pre></div>


<p>The Cloudflare credentials stored on the FreeBSD setup, which used acme.sh, are easy enough to use with certbot.  Create <code>~root/.cloudflare.ini</code> and ensure it is mode 0600 so only root can read it, then add the appropriate credentials.  To create and install the certificate, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>certbot<span class="w"> </span>certonly<span class="w"> </span>--dns-cloudflare<span class="w"> </span>-d<span class="w"> </span>git.mydomain.com<span class="w"> </span>--installer<span class="w"> </span>nginx
</pre></div>


<p>Obviously change <code>git.mydomain.com</code> to whatever the hostname for your Gitea server is.  Finally, update the nginx configuration to point to the Let&#8217;s Encrypt certificates produced and then setup certbot for automatic renewals <a href="https://eff-certbot.readthedocs.io/en/latest/using.html#setting-up-automated-renewal">following the instructions</a>.  Now we can start nginx and Gitea and make them start at boot, as&nbsp;root:</p>
<div class="highlight"><pre><span></span>rc-service<span class="w"> </span>nginx<span class="w"> </span>start
rc-update<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span>default
rc-service<span class="w"> </span>gitea<span class="w"> </span>start
rc-update<span class="w"> </span>add<span class="w"> </span>gitea<span class="w"> </span>default
</pre></div>


<h2 id="final-steps">Final steps<a class="headerlink" href="#final-steps" title="Permanent link"> </a></h2>
<p>At this point Gitea is running and the web interface works with <span class="caps">HTTPS</span>.  Going into the Gitea &#8220;Site Administration&#8221; settings and making sure there are no errors in the &#8220;Maintenance &gt; Self Check&#8221; section is a good idea.  That said, for this migration, there were a lot of git repos which meant there were a lot of git hooks to regenerate because the old hooks from the FreeBSD system were using different paths to the gitea binary and directories.  This is easily fixed with gitea to fix things, as the gitea&nbsp;user:</p>
<div class="highlight"><pre><span></span>gitea<span class="w"> </span>admin<span class="w"> </span>regenerate<span class="w"> </span>hooks<span class="w"> </span>--config<span class="w"> </span>/etc/gitea/app.ini
gitea<span class="w"> </span>admin<span class="w"> </span>regenerate<span class="w"> </span>keys<span class="w"> </span>--config<span class="w"> </span>/etc/gitea/app.ini
</pre></div>


<p>This will regenerate both the git hooks and the ssh keys&nbsp;needed.</p>
<p>In the end, it worked great.  In fact, I was surprised that it worked as well as it did!  At the time of this writing, Gitea 1.25.1 is available and part of me wants to give it a go, however I&#8217;ve solved the primary problem: moving my Gitea server from FreeBSD to Linux, from TrueNAS Core jails to a TrueNAS Scale virtual machine.  I think I&#8217;ll wait for the Alpine community repo to get me to the right version so I don&#8217;t have to hack my way to newer versions.  Gitea is awesome, and is so much lighter to operate than GitLab (which I used before, but I don&#8217;t need all those features, many of which Gitea now has anyways).  These are for my own projects and code that I don&#8217;t want to host on GitHub, and I don&#8217;t need all the latest and greatest features.  Arguably, I could have chosen a different distro that maybe provided more recent versions but even then, my goal was lightweight and Alpine delivers that in spades.  It&#8217;s shocking how little memory and <span class="caps">CPU</span> it uses, so it felt like a good fit for my&nbsp;needs.</p>
<p>Once Alpine catches up to or surpasses the 1.24.2 version I&#8217;m running, I can dispense with the hack which made me a little nervous at first but I honestly think it&#8217;ll be fine.  I have to change some <code>.git/config</code> files on a few systems for a bunch of repos to connect as the <code>gitea</code> user and not <code>git</code> but that&#8217;s fine also and only matters for those that are ssh-based.  <span class="caps">DNS</span> changes were required, but now everything is connecting to the new Gitea server as easily as they were to the&nbsp;old.</p>
<p>The only thing remaining, which I&#8217;ve not had time for yet (as it&#8217;s a little more disruptive), is setting up network bridging on the TrueNAS host. This will let me mount volumes from the TrueNAS server in the virtual machines so I can store the Gitea backups on the more spacious <span class="caps">NAS</span>.  But that&#8217;s something for another day, and really most necessary for when I migrate the Plex server&nbsp;over.</p>
<p>If this was interesting, amusing, or even remotely helpful then it was worth the time keeping notes and writing&nbsp;it!</p>


             
 
                <p id="post-share-links">
    Share on:
      <a href="https://twitter.com/intent/tweet?text=Moving%20Gitea%20from%20FreeBSD%20to%C2%A0Linux&url=https%3A//annvix.com/blog/moving-gitea-from-freebsd-to-linux&hashtags=linux,truenas,freebsd,gitea,git,alpine" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
 ‚ùÑ       <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//annvix.com/blog/moving-gitea-from-freebsd-to-linux&title=Moving%20Gitea%20from%20FreeBSD%20to%C2%A0Linux&summary=I%E2%80%99ve%20been%20using%20TrueNAS%20for%20a%20number%20of%20years%2C%20from%20when%20it%20was%20FreeBSD-based%20to%20now%20that%20it%E2%80%99s%20Linux-based.%20%20Right%20now%20I%20use%20them%20both%3A%20TrueNAS%20Core%20%28FreeBD%29%20and%20TrueNAS%20Scale%20%28Linux%29.%20%20The%20TrueNAS%20Scale%20box%20has%20been%20mostly%20for%20fiddling%20with%20containers%2C%20while%20the%20TrueNAS%20Core%20box%20%E2%80%A6&source=https%3A//annvix.com/blog/moving-gitea-from-freebsd-to-linux" target="_blank" rel="nofollow noopener noreferrer" title="Share on LinkedIn">LinkedIn</a>

            
            







            <hr/>
<section>
    <h2>Related Posts</h2>
<ul class="related-posts-list">
<li><a href="https://annvix.com/blog/holiday-hacking" title="Holiday¬†Hacking">Holiday¬†Hacking</a></li>
<li><a href="https://annvix.com/blog/compiler-the-new-security-landscape" title="Compiler: The New Security¬†Landscape">Compiler: The New Security¬†Landscape</a></li>
<li><a href="https://annvix.com/blog/accessing-truenas-shares-from-a-nested-vm" title="Accessing TrueNAS shares from a nested VM">Accessing TrueNAS shares from a nested VM</a></li>
<li><a href="https://annvix.com/blog/weekend-shenanigans" title="Weekend¬†Shenanigans">Weekend¬†Shenanigans</a></li>
<li><a href="https://annvix.com/blog/gitea-container-registry-with-podman" title="Gitea container registry with¬†podman">Gitea container registry with¬†podman</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">¬´ <a href="https://annvix.com/blog/compiler-the-new-security-landscape" title="Previous: Compiler: The New Security¬†Landscape">Compiler: The New Security¬†Landscape</a></li>
                <li class="next-article"><a href="https://annvix.com/blog/accessing-truenas-shares-from-a-nested-vm" title="Next: Accessing TrueNAS shares from a nested VM">Accessing TrueNAS shares from a nested VM</a> ¬ª</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2025-11-18T18:04:00-07:00">Nov 18, 2025</time>
            <h4>Category</h4>
            <a class="category-link" href="https://annvix.com/categories#linux-ref">Linux</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://annvix.com/tags#alpine-ref">alpine
                    <span class="superscript">2</span>
</a></li>
                <li><a href="https://annvix.com/tags#freebsd-ref">freebsd
                    <span class="superscript">1</span>
</a></li>
                <li><a href="https://annvix.com/tags#git-ref">git
                    <span class="superscript">13</span>
</a></li>
                <li><a href="https://annvix.com/tags#gitea-ref">gitea
                    <span class="superscript">1</span>
</a></li>
                <li><a href="https://annvix.com/tags#linux-ref">linux
                    <span class="superscript">22</span>
</a></li>
                <li><a href="https://annvix.com/tags#truenas-ref">truenas
                    <span class="superscript">7</span>
</a></li>
            </ul>
<h4>Stay in touch</h4>
<div id="sidebar-social-link">
    <a href="https://twitter.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://github.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/vdanen/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://infosec.exchange/@vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mastodon" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%"/><path d="m409 290c-5 24-43 50-85 56-86 11-137-6-137-6 3 13-4 54 70 52 31 0 58-7 58-7l2 27c-51 24-107 15-140 6-67-17-79-90-81-162v-59c0-74 49-96 49-96 50-24 180-22 222 0 0 0 49 22 49 96 0 0 1 55-7 93" fill="#3088d4"/><path d="m358 202v91h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Copyright &copy; 2024 Vincent Danen
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://annvix.com/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>