<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/custom.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/fontawesome.min.css" media="screen">
        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta name="description" content="One feature many firewall appliances have been pushing recently is content filtering proxies, whether transparent or authenticated. These content filtering proxies are a boon to individuals with young children in the house, but many of them are extremely basic. Without pointing any fingers, I had purchased a content filtering firewall …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">


<meta property="og:title" content="DansGuardian: A Content Filtering System "/>
<meta property="og:url" content="https://vdanen.github.io/dansguardian_a_content_filtering_system" />
<meta property="og:description" content="One feature many firewall appliances have been pushing recently is content filtering proxies, whether transparent or authenticated. These content filtering proxies are a boon to individuals with young children in the house, but many of them are extremely basic. Without pointing any fingers, I had purchased a content filtering firewall …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2008-03-25T14:00:00-06:00" />
<meta name="twitter:title" content="DansGuardian: A Content Filtering System ">
<meta name="twitter:description" content="One feature many firewall appliances have been pushing recently is content filtering proxies, whether transparent or authenticated. These content filtering proxies are a boon to individuals with young children in the house, but many of them are extremely basic. Without pointing any fingers, I had purchased a content filtering firewall …">

        <title>DansGuardian: A Content Filtering System  · Annvix
</title>
        <link rel="shortcut icon" href="https://vdanen.github.io/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://vdanen.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://vdanen.github.io/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://vdanen.github.io/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://vdanen.github.io/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://vdanen.github.io/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://vdanen.github.io/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://vdanen.github.io/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://vdanen.github.io/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://vdanen.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://vdanen.github.io/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://vdanen.github.io/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5JGVD90SKJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5JGVD90SKJ');
</script>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://vdanen.github.io/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://vdanen.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://vdanen.github.io/about">About</a></li>
                                <li ><a href="https://vdanen.github.io/documentation">Documentation</a></li>
                                <li ><a href="https://vdanen.github.io/categories">Categories</a></li>
                                <li ><a href="https://vdanen.github.io/tags">Tags</a></li>
                                <li ><a href="https://vdanen.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://vdanen.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="https://vdanen.github.io/dansguardian_a_content_filtering_system"> DansGuardian: A Content Filtering&nbsp;System  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Configuring_DansGuardian"><span class="tocnumber">1</span> <span class="toctext">Configuring DansGuardian</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Configuring_Squid"><span class="tocnumber">2</span> <span class="toctext">Configuring Squid</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#A_Word_On_Apache"><span class="tocnumber">3</span> <span class="toctext">A Word On Apache</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#PICS_Filtering"><span class="tocnumber">4</span> <span class="toctext"><span class="caps">PICS</span> Filtering</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Weighted_Phrases"><span class="tocnumber">4.1</span> <span class="toctext">Weighted Phrases</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#References"><span class="tocnumber">4.2</span> <span class="toctext">References</span></a></li>
</ul>
</li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            <p>One feature many firewall appliances have been pushing recently is content filtering proxies, whether transparent or authenticated. These content filtering proxies are a boon to individuals with young children in the house, but many of them are extremely basic. Without pointing any fingers, I had purchased a content filtering firewall appliance that promised content filtering and was sorely disappointed. The content filtering was extremely basic and was solely word-based. Unfortunately, this word list was something the end user had to enter in by hand. So if you’re looking to keep your children from stumbling across some pornographic web pages, you have to get pretty creative to populate your word list. The other drawback to this particular appliance was that port forwarding didn’t work. Eventually it was this drawback that convinced me to sell it; my daughter is only a year and a half and won’t be surfing solo anytime soon.
</p>
<p>As a result, I took an unused desktop computer and installed MandrakeSoft’s Multi-Network Firewall 8.2 on it, to replace the now removed firewall appliance. While the end result may have been more expensive, you can’t put a price on flexibility. And by using a Linux-based firewall operating system, I get all the flexibility I want.
</p>
<p>One way you can configure <span class="caps">MNF</span> is to use <a class="external text" href="http://www.squid-cache.org/" rel="nofollow">Squid</a> as a transparent proxy, which is ideal. No reconfiguration of the <span class="caps">LAN</span> to point everything to a proxy. Cached web pages. And the ability to use <a class="external text" href="http://www.dansguardian.org/" rel="nofollow">DansGuardian</a> as a content filter. <span class="caps">MNF</span> also comes with <a class="external text" href="http://www.squidguard.org/" rel="nofollow">squidGuard</a> which is nice, but doesn’t seem to be as flexible as DansGuardian when it comes to content filtering.
</p>
<p>DansGuardian has a few requirements. It requires Squid for the web proxy, and it requires a web server like Apache. It does not require <span class="caps">MNF</span>, and while this was written to use DansGuardian on <span class="caps">MNF</span>, it will run on a variety of operating systems including any Linux, FreeBSD, OpenBSD, and even <span class="caps">OS</span> X (although at the time of this writing, the <span class="caps">OS</span> X support is alpha quality).
</p>

<h2><span class="mw-headline" id="Configuring_DansGuardian">Configuring DansGuardian</span></h2>
<p>Building DansGuardian is very straightforward. For the purpose of this tutorial, we will assume DansGuardian is installed in the system so the binary is in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/usr/sbin</span> and the configuration files are in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/dansguardian</span>. DansGuardian comes with a logrotation script that is installed into <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/dansguardian</span>, called <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">logrotation</span>. This should be executed weekly, so you should add the following to your crontab (as root):
</p>
<pre>
59 23 * * sat /etc/dansguardian/logrotation
</pre>
<p>You can modify your system crontab by executing <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">crontab -e</span>. Another alternative, for systems that use <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">logrotate</span> is to create a file called <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian</span> in your <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/logrotate.d</span> directory that looks like this:
</p>
<pre>
/var/log/dansguardian/access.log {
    weekly
    rotate 5
    copytruncate
    compress
    notifempty
    missingok
}
</pre>
<p>If you do choose to use the script that comes with DansGuardian make sure you <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">chmod 0700</span> the script to make it executable.
</p>
<p>To start DansGuardian you can use the SysV-style initscript (ie. Mandrakelinux packages come with <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/rc.d/init.d/dansguardian</span> which can be started by using <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">service dansguardian start</span>), or you can just execute <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">dansguardian</span> on the commandline. If you start DansGuardian in this way, you can use the typical “kill” method of stopping it, or use <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">dansguardian -q</span>.
</p>
<p>The main configuration file for DansGuardian is <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/dansguardian/dansguardian.conf</span>. There are a number of other files included, these are the banned lists and exception lists. These files all reside in the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/dansguardian</span> directory as well. Every time you make a change to any of these files, you will need to restart DansGuardian, and this can be accomplished by executing <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">dansguardian -r</span> as root.
</p>
<p>The following files make up the overall configuration of DansGuardian:
</p>
<table border="0">
<tr>
<th style="background:#efefef;"> File
</th>
<th style="background:#efefef;"> Description
</th></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">exceptioniplist</span> </td>
<td> This file contains a list of client <span class="caps">IP</span> addresses that you wish to allow unrestricted access (no filtering).
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">exceptionphraselist</span> </td>
<td> This file contains a list of phrases that, if they appear in a web page, will bypass filtering. You may want to use the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">weightedphraselist</span> instead, as this can result in a lot of pages not being blocked.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">exceptionsitelist</span> </td>
<td> This file contains a list of domain endings that if found in the requested <span class="caps">URL</span>, will not be filtered.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">exceptionurllist</span> </td>
<td> This file contains a list of <span class="caps">URL</span> parts for sites where filtering should be turned off.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">exceptionuserlist</span> </td>
<td> This file contains a list of usernames that will not be filtered (you must use basic authentication or ident must be enabled for this to work).
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedextensionlist</span> </td>
<td> This file contains a list of file extensions that will be banned. This can be used to restrict users from downloading screen savers, executable files, viruses, and so forth.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannediplist</span> </td>
<td> This file contains a list of client <span class="caps">IP</span> addresses that will not get web access at all.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedmimetypelist</span> </td>
<td> This file contains a list of <span class="caps">MIME</span>-types that will be banned. If a <span class="caps">URL</span> request returns a <span class="caps">MIME</span>-type in this list, DansGuardian will block it. This can be used to block movies, but shouldn’t be used to graphic image files or text/html, etc.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedphraselist</span> </td>
<td> This file contains a list of phrases that will result in banning a page. Each phrase must be enclosed between &lt; and &gt; characters, and they may contain spaces. You can also use a combination of phrases that, if all are found in a page, will result in it being blocked.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedregexpurllist</span> </td>
<td> This file contains a list of regular expression URLs that will be banned. that will be banned. This can be used to restrict users from downloading screen savers, executable files, viruses, and so forth.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedsitelist</span> </td>
<td> This file contains a list of sites that are to be banned. You can use <span class="caps">IP</span> addreses here as well as domain names, and can even include stock SquidGuard blacklists as well.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedurllist</span> </td>
<td> This file contains a list of <span class="caps">URL</span> parts to block, which allows you to block parts of a site rather than the entire site. You can also use SquidGuard lists here as well.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">banneduserlist</span> </td>
<td> This file contains a list of usernames to whom, if basic proxy authentication is enabled, access will be denied automatically.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">weightedphraselist</span> </td>
<td> This file contains a list of phrases with a corresponding positive or negative value. As phrases are encountered in a page, the total “value” of the page will be calculated based on these values; good phrases will have negative values and bad phrases will have positive values. One the Naughtiness Limit has been reached (defined in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian.conf</span>, the page will be blocked.
</td></tr>
<tr>
<td> <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">pics</span> </td>
<td> This file contains a number of <span class="caps">PICS</span> sections that allow you to fine-tune your <span class="caps">PICS</span> filtering. The defaults for DansGuardian are for young children (mild profanity, artistic nudity, etc.).
</td></tr></table>
<p>Each of these configuration files are very straightforward and are basically one item per line (ie. a <span class="caps">URL</span> or <span class="caps">IP</span> address, etc.).
</p>
<p>The <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian.conf</span> file is the primary configuration file for DansGuardian. It is here that you will configure things like logging, where to redirect users when attempting to access a denied page, and so forth. The file is heavily commented and fairly straightforward.
</p>
<p>An example <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian.conf</span> file without comments follows:
</p>
<pre>
reportinglevel = 2
htmltemplate = '/etc/dansguardian/template.html'
accessdeniedaddress = http://10.0.5.1:8444/cgi-bin/dansguardian.pl

loglevel = 3

filterip =
filterport = 3328
proxyport = 3128
proxyip = 10.0.5.1

bannedphraselist = '/etc/dansguardian/bannedphraselist'
exceptionphraselist = '/etc/dansguardian/exceptionphraselist'
weightedphraselist = '/etc/dansguardian/weightedphraselist'
bannedsitelist = '/etc/dansguardian/bannedsitelist'
exceptionsitelist = '/etc/dansguardian/exceptionsitelist'
exceptionurllist = '/etc/dansguardian/exceptionurllist'
bannedurllist = '/etc/dansguardian/bannedurllist'
bannedregexpurllist = '/etc/dansguardian/bannedregexpurllist'
bannedextensionlist = '/etc/dansguardian/bannedextensionlist'
bannedmimetypelist = '/etc/dansguardian/bannedmimetypelist'
bannediplist = '/etc/dansguardian/bannediplist'
exceptioniplist = '/etc/dansguardian/exceptioniplist'
banneduserlist = '/etc/dansguardian/banneduserlist'
exceptionuserlist = '/etc/dansguardian/exceptionuserlist'
picsfile = '/etc/dansguardian/pics'

weightedphrasemode = 1
naughtynesslimit = 50
showweightedfound = on

reverseaddresslookups = off
createlistcachefiles = on
maxuploadsize = -1

username_id_method_proxyauth = off
username_id_method_ntlm = off # **NOT IMPLEMENTED**
username_id_method_ident = on

forwarded_for = off
maxchildren = 120
log_connection_handling_errors = on
</pre>
<p>This is a fairly standard configuration one might have; you can even use it verbatim provided you change <span class="caps">IP</span> addreses and port settings to match your own system.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">reportinglevel</span> setting tells DansGuardian to fully report why access was denied (ie. give the denied phrase). You may choose to use a level of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">1</span> instead, or <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">3</span> to use the <span class="caps">HTML</span> template file. If you use the <span class="caps">HTML</span> template file, then the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">htmltemplate</span> file needs to be set to the full path and filename of the template file you wish to use. If you use a setting of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">0</span> through <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">2</span> you will need to set the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">accessdeniedaddress</span> keyword. In this case, it’s pointing to the internal <span class="caps">IP</span> address of our firewall (10.0.5.1), and the port it listens to (in this case port 8444). It also contains the full path to the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian.pl</span> <span class="caps">CGI</span> script.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">loglevel</span> keyword is to determine what gets logged to the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/log/dansguardian/access.log</span> logfile.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">filterip</span> determines what <span class="caps">IP</span> address that DansGuardian will listen on. If left blank, all IPs will be listened on. The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">filterport</span> keyword is the port that DansGuardian will bind to. The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">proxyip</span> is the <span class="caps">IP</span> address of the proxy; usually the localhost. The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">proxyport</span> is the port to use to connect to the proxy (in this case, 3128, which is the port that Squid is listening on).
</p>
<p>The keywords following are all related to the various configuration files discussed earlier, and simply include them to be a part of the configuration.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">weightedphrasemode</span> determines how weighted phrases are used. A setting of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">1</span> is for normal operation. The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">naughtynesslimit</span> keyword sets the limit over which a page will be blocked. This is based on the values of the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">weightedphraselist</span> file and each “hit” on a page will modify the naughtyness of the page. The higher the rating, the “naughtier” the page. As a general rule of thumb, with the default settings, a limit of 50 is suitable for young children, 100 for older children, and 160 for young adults.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">showweightedfound</span> keyword determines whether the phrases found that made up the total that exceeds the naughtyness limit will be logged, and if <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">reportinglevel</span> is set to <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">2</span>, reported.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">reverseaddresslookups</span> keyword determines whether or not DansGuardian will look up the forward <span class="caps">DNS</span> for an <span class="caps">IP</span> <span class="caps">URL</span> address and search for both the banned site and <span class="caps">URL</span> lists. This is useful for preventing a user from simply entering the <span class="caps">IP</span> address for a banned site. It can also have an impact on the searching speed, however.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">createlistcachefiles</span> keyword determines whether or not the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedsitelist</span> and <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">bannedurl</span> files will be cached. Fast computers do not need this, but on slower computers this could result in a significant process start speed increase.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">maxuploadsize</span> keyword is used for <span class="caps">POST</span> protection on web upload forms. A setting of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">-1</span> disables, a setting of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">0</span> blocks completely, and any other value sets the file upload size in kilobytes (after <span class="caps">MIME</span> encoding and headers).
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">forward_for</span> keyword, if enabled, will add an X-Forwarded-For to the <span class="caps">HTTP</span> request header. This may be required for some sites that need to know the source <span class="caps">IP</span>.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">maxchildren</span> keyword sets the maximum number of processes to spawn to handle incoming connections. This can be used to prevent DoS attacks from killing the server by maxing out spawned processes.
</p>
<p>The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">log_connection_handling_errors</span> keyword is used to determine if DansGuardian will log debug info to syslog.
</p>
<h2><span class="mw-headline" id="Configuring_Squid">Configuring Squid</span></h2>
<p>No real special configuration needs to be done with Squid, although the use of Squid is required. DansGuardian will appear to Squid to be a normal web browser. However, the system must be configured in such a way that users cannot bypass DansGuardian, just as they should not be able to bypass Squid. You can do this either with an authenticated proxy (ie. users must log into the proxy to be able to access the network andprovide valid credentials), or you can use a transparent proxy, one where outbound web traffic is routed through the proxy without the end user even knowing it’s there; it’s all done at the firewall level.
</p>
<p>For instance, on a system with just Squid doing web proxying, you might have the firewall redirect all request to outbound port 80 (<span class="caps">HTTP</span>) to localhost port 3328 (the proxy). With this method, the end user does not need to reconfigure their browser, and isn’t even aware of the proxy at all… until it is unable to connect to a website on their behalf or blocks a site due to DansGuardian.
</p>
<p>Taking this further, there is a certain process that needs to be followed. What you want to accomplish is the following:
</p>
<pre>
lan -&gt; fw -&gt; fw -&gt; wan
</pre>
<p>Or, looking at it a different way:
</p>
<pre>
client -&gt; DansGuardian -&gt; Squid -&gt; server
</pre>
<p>On the Multi Network Firewall system I use, Squid is configured to list on port 3328; the port that DansGuardian listens to by default. Changing <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/squid/squid.conf</span> so that Squid listens now on port 3128, DansGuardian can be activated. DansGuardian will always connect to Squid on this port, so you must have Squid listening there. It’s a simple matter of modifying one file and restarting Squid, then starting DansGuardian. The firewall rules for the transparent proxy don’t even need to be changed as the firewall will have previously forwarded <span class="caps">HTTP</span> requests to port 3328 on the localhost.
</p>
<h2><span class="mw-headline" id="A_Word_On_Apache">A Word On Apache</span></h2>
<p>The Apache configuration is extremely straightforward and not really worth mentioning, however for the sake of completeness, here it is. Apache must be running on the firewall, and your firewall rules should ensure that the outside world cannot access it. You could also configure Apache to listen to some non-standard port, perhaps port 8000 or some other un-used port. The installation of DansGuardian should have placed the file <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian.pl</span> into your web server’s cgi-bin directory. This is all that Apache really needs to serve, so you can lock down Apache to only serve this one particular <span class="caps">CGI</span>.
</p>
<p>When DansGuardian blocks a page, it will redirect the client to the specified server to view the reasons why the page was blocked, or simply that access was denied (depending upon how you configured it). The Apache server should listen only on the internal interface (<span class="caps">LAN</span>-side). You can do this by setting the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">BindAddress</span> keyword in your Apache configuration files.
</p>
<h2><span class="mw-headline" id="PICS_Filtering"><span class="caps">PICS</span> Filtering</span></h2>
<p>The <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">pics</span> file contains information for <span class="caps">PICS</span> filtering. The first keyword in the file is <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">enablePICS</span> and this determines whether <span class="caps">PICS</span> filtering will be used. If it is disabled, all other <span class="caps">PICS</span>-related settings are ignored.
</p>
<p><span class="caps">PICS</span> stands for Platform for Internet Content Selection. This specification allows for metadata to be associated with internet content. It was designed to help control what children access on the internet, and is used in this capacity in DansGuardian.
</p>
<p>Building on <span class="caps">PICS</span> is the <span class="caps">ICRA</span>, or Internet Content Rating Association. This also provides a rating system for websites (one may often see “We rated with <span class="caps">RSAC</span>” slogans on adult websites). The <span class="caps">ICRA</span> used to be <span class="caps">RSAC</span> (Recreational Software Advisory Council). A number of keywords in the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">pics</span> file deal with <span class="caps">ICRA</span> ratings, to allow you to tailor DansGuardian to your needs. For instance, the keyword <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">ICRAnuditygraphic</span> would allow (<span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">1</span>) or disallow (<span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">0</span>) graphic nudity. You may want to disallow that, yet allow <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">ICRAnudityeducational</span>. It’s entirely up to you. There are <span class="caps">RSAC</span> keywords, because many sites still use <span class="caps">RSAC</span> instead of using the newer <span class="caps">ICRA</span> rating system. The <span class="caps">RSAC</span> keywords have a range of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">0</span> (none) to <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">4</span> (wanton and gratuitous). A setting of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">2</span> is default.
</p>
<p>Yet another rating system is the evaluWEB rating system, which is similar to the British Film classifcation system. The <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">evaluWEBrating</span> keyword can take the following ratings:
</p>
<ul><li> <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">U</span> - universal; suitable for children unattended</li>
<li> <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">1</span> - <span class="caps">PG</span>; Parental Guidance recommended</li>
<li> <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">2</span> - 18+; only suitable for adults</li></ul>
<p>CyberNOT is another rating system, and there are two keywords that deal with it; each keyword can be a value of <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">0</span> (none) to <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">8</span> (lots). The default is <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">3</span>.
</p>
<p>SafeSurf is similar to <span class="caps">RSAC</span>, but contains a larger range of categories that can be set from <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">0</span> (none) to <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">9</span> (wanton and gratuitos). You can set the age of the viewer by using the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">SafeSurferagerange</span> keyword to <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">1</span> (all ages), <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">3</span> (early teens, the default), to <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">9</span>, explicitly for adults.
</p>
<p>Weburbia is a similar rating system to evaluWEB.
</p>
<p>Finally, Vancouver Webpages is another <span class="caps">PICS</span>-based rating system. There are a number of keywords dealing with it, each one is commented as they take different values. The general rule of thumb is that a low number is good, a high number is bad.
</p>
<p>To really fine-tune DansGuardian you should spend a little time in the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">pics</span> file adjusting it for your needs. The <span class="caps">PICS</span>, and similar, rating systems can help with a number of sites, but they are all voluntary. In other words, the webmaster of an adult site must voluntarily place the appropriate metadata for rating on their pages; not all webmasters do this. For some it’s a matter of being lazy, for others they simply don’t care. The (more or less) ethical adult sites will use one or more of these rating systems to protect children from viewing content not suitable for them.
</p>
<p>In other words, <span class="caps">PICS</span> is a helpful addition to your arsenal, but you will likely see better results using weighted phrases. For instance, to include the stock weighed phrase list on pornography, you would use:
</p>
<h3><span class="mw-headline" id="Weighted_Phrases">Weighted Phrases</span></h3>
<p>The <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">weightedphraselist</span> file contains instructions on how to use weighted phrases, and includes a number of files dealing with various topics.
</p>
<pre>
.Include&lt;/etc/dansguardian/phraselists/pornography/weighted&gt;
</pre>
<p>Feel free to add your own weighted phrases to this file or create your own and have it included in a similar manner.
</p>
<p>This is used by the naughtiness limit that is configured in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">dansguardian.conf</span>. Adding a positive weight increases the naughtiness rating, while adding a negative weight decreases it. For instance:
</p>
<pre>
&lt;slut&gt;&lt;10&gt;
&lt; slut &gt;&lt;10&gt;
&lt;slut&gt;,&lt;horny&gt;&lt;50&gt;
&lt;breast&gt;,&lt;medical&gt;&lt;-30&gt;
&lt;education&gt;&lt;-25&gt;
</pre>
<p>The first adds 10 to the count on any occurance of the string “slut” in a page (ie. sluts, slut!, abslutxyz).
</p>
<p>The second adds 10 the count on any occurance of the <i>word</i> “slut” (ie. Sally is a slut that visits…).
</p>
<p>The third adds 50 to the count when the strings “slut” and “horny” are found on the same page.
</p>
<p>The forth subtracts 30 from the count when the strings “breast” and “medical” are found on the same page.
</p>
<p>Finally, if the string education is found on the page, 25 is subtracted from the count.
</p>
<p>You can find a number of tailored files for various age ranges and situations at the DansGuardian homepage in the <a class="external text" href="http://www.dansguardian.org/?page=extras" rel="nofollow">Extras</a> section.
</p>
<h3><span class="mw-headline" id="References">References</span></h3>
<ul><li> <a class="external text" href="http://www.dansguardian.org/" rel="nofollow">DansGuardian homepage</a></li>
<li> <a class="external text" href="http://www.squid-cache.org/" rel="nofollow">Squid homepage</a></li>
<li> <a class="external text" href="http://www.squidguard.org/" rel="nofollow">squidGuard homepage</a></li>
<li> <a class="external text" href="http://www.apache.org/" rel="nofollow">Apache homepage</a></li>
<li> <a class="external text" href="http://www.w3.org/PICS/" rel="nofollow"><span class="caps">PICS</span> specification</a></li>
<li> <a class="external text" href="http://www.icra.org/" rel="nofollow"><span class="caps">ICRA</span> homepage</a></li>
<li> <a class="external text" href="http://www.safesurf.com/" rel="nofollow">SafeSurf homepage</a></li>
<li> <a class="external text" href="http://www.weburbia.com/safe/index.shtml" rel="nofollow">Weburbia homepage</a></li>
<li> <a class="external text" href="http://vancouver-webpages.com/VWP1.0/" rel="nofollow">Vancouver Webpages homepage</a></li>
<li> <a class="external text" href="http://www.dansguardian.org/?page=extras" rel="nofollow">DansGuardian Extras</a></li></ul>
            







        </div>
    </div>
    </article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Copyright &copy; 2023 Vincent Danen
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://vdanen.github.io/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>