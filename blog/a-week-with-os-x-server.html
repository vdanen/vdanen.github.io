<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", Macos, " />

<meta property="og:title" content="A week with OS X server "/>
<meta property="og:url" content="https://vdanen.github.io/blog/a-week-with-os-x-server.html" />
<meta property="og:description" content="Last year I wrote about my 20 minutes with OS X Leopard server. This week I had the opportunity, and the obligation, to spend a bit more time with it. Next month I&#39;m converting an office that&#39;s currently using Windows and Exchange for an OS X-based solution. There will be …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2008-07-11T17:47:00-06:00" />
<meta name="twitter:title" content="A week with OS X server ">
<meta name="twitter:description" content="Last year I wrote about my 20 minutes with OS X Leopard server. This week I had the opportunity, and the obligation, to spend a bit more time with it. Next month I&#39;m converting an office that&#39;s currently using Windows and Exchange for an OS X-based solution. There will be …">

        <title>A week with OS X server  · Annvix
</title>
        <link href="https://vdanen.github.io/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://vdanen.github.io/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://vdanen.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://vdanen.github.io/about.html">About</a></li>
                                <li ><a href="https://vdanen.github.io/documentation.html">Documentation</a></li>
                                <li ><a href="https://vdanen.github.io/categories.html">Categories</a></li>
                                <li ><a href="https://vdanen.github.io/tags.html">Tags</a></li>
                                <li ><a href="https://vdanen.github.io/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://vdanen.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://vdanen.github.io/blog/a-week-with-os-x-server.html">
                A week with OS X server
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Last year I wrote about my <a href="http://linsec.ca/blog/2007/11/09/20-minutes-with-os-x-leopard-server/">20 minutes with OS X Leopard server</a>.  This week I had the opportunity, and the obligation, to spend a bit more time with it.  Next month I'm converting an office that's currently using Windows and Exchange for an OS X-based solution.  There will be a few desktops, a laptop, and an xserve.  Not really a big deal for what he wants as OS X server will take care of pretty much everything and I knew that it wouldn't take me too long to catch onto it, but I wanted to take the time to figure out any quirks before I actually obtained the hardware and started billing for my time.  Since the server software purchase will get absorbed in the cost of the work, and would probably save a lot of time down the road, I picked up a copy late last week and have been slowly working this week to get my old dual G5 up and running to (temporarily, at least) replace my Mandriva-based LAN server.</p>
<p>I've read some blog posts in the last week or so saying how Apple deviates too much from UNIX, how OS X server isn't as good for web serving as Linux, etc.  Unfortunately, those posts look worse for the blogger than for the software.  OS X server is no worse for web hosting (or "service" hosting) as anything else.  The problem is these people probably spent a few hours or maybe a day or two at most trying to figure stuff out.  And they took all their Linux "baggage" with them.  Well, they're right in one thing... it is different.  Very different.  Is it worse?  Not really... it does the same job.  The tools are different, file locations are different, etc.</p>
<p>The server I setup has the following duties:  DHCP, DNS, intranet wiki, nagios monitor, SMTP relay (for the LAN going out), POP3/IMAP (LAN-only), file sharing (samba and since we're using OS X here AFP as well), LDAP for authentication, and subversion server.  The client's xserve will do most of this, except for nagios.  It will also require handling a VPN, so I will be setting up mine to do the same.</p>
<!--more-->

<p>There are quite a few things that are different.  Server Admin is a very cool GUI tool to configure the server.  For the most part, it works really really well.  It was somewhat painful setting up DHCP and DNS since I couldn't import my old named zone files and such (at least not that I could find).  But after an hour of mind-numbing and boring typing, it worked well enough.  Setting up Apache was easy enough and Server Admin works for some basic stuff, although if you really want to do more complex things, you'll want to fiddle around in <i>/etc/apache2/</i> to make changes.  One word of warning:  some stuff you can change and still use Server Admin and it won't get mangled.  Some stuff you can't so I suggest getting the basics done in Server Admin and then <i>not</i> using it to manage sites (even viewing the site seems to be enough to trigger an update of the config file).  In particular, setting "DAV svn" to enable the http subversion access resulted in (repeated) changes to "DAV off".  Apparently Server Admin doesn't thing "svn" is a valid option here.  Also, rewrite rules kept getting rewritten... with a whole lot of nothing.  I use rewrite rules extensively for my mediawiki install so it ticked me off a few times when all of a sudden they stopped working.  Beyond that, Server Admin works well enough for Apache (again, more basic stuff).  I suppose I could be using .htaccess files for this stuff and then I wouldn't have to worry about Server Admin removing stuff on me.</p>
<p>Setting up subversion was pretty easy, less the rewriting noted above.  <a href="http://blog.paploo.net/2007/10/how-to-manage-your-own-subversion.html">This blog post</a> was moderately helpful for anyone else interested in setting up a subversion server on OS X.  Leopard is using 1.4.4, but I think I'll be upgrading that soon, which may prove interesting to see if/how it will use the new modules instead of the old ones without actually removing the old subversion setup, since it comes with OS X.  Setting up ViewVC for a web view of the subversion repository was pretty straightforward as well.  No real surprises there.</p>
<p>Nagios was more interesting.  Actually, it wasn't too bad... just time consuming.  The Mandriva nagios configs are.. fugly.. to put it bluntly.  Too many files, too many different places to look, so I spent quite a bit of time smushing all the useful stuff into a half-dozen configs which makes it much easier to manage.  I built the latest nagios and nagios plugins from source.  Before that, make sure you have something like fink or macports (I use fink) installed, as well as the Xcode developer tools.  Beyond that, it was pretty straightforward as well.  The only problem I ran into was the check_ldap(s) plugins didn't want to work... not sure if this is due to a newer version or if it's due to Open Directory.  I've disabled that plugin for now (although, strangely enough, the check_ircd plugin works now when it wasn't working on Mandriva... go figure).  Oh, if you like to use the check_fping plugin, use fink to install fping but make sure you make /sw/sbin/fping suid root, otherwise the plugin running under nagios (which here runs as nagios:nagios) won't be able to use it.</p>
<p>MySQL was easy.  Set the root password in Server Admin and imported a dump of my database.  No issues there.</p>
<p>Mail was different, and I used Server Admin exclusively for that.  Seems to have enough options and through it can handle spam filtering via spamassassin and virus scanning via clamav.  I'm used to exim myself, and OS X uses postfix, so I think I'll let Server Admin handle that part.  What I've done with it so far works well enough, and POP3 works.  I'm thinking of seeing if I can get procmail and fetchmail running on there to grab my mail, filter it all into individual IMAP mailboxes, and just use IMAP to connect to my local server to get all my mail.  Not sure if that will work very well (due to personal and work accounts being smushed into one IMAP setup), but I think that would largely be a client-side issue anyways.</p>
<p>The weirdest thing for me, and the one big drawback to OS X that I found, was the handling of IP aliases.  I don't want to write silly route commands, I want aliases to be setup once and persist across reboots, etc.  Took me a bit, but it's clumsy compared to Linux.  With Mandriva, I just create new /etc/sysconfig/network-scripts/ifcfg-eth0:0 files and go to town.  With OS X, you have to edit /etc/IPAliases.conf and stuff like:</p>
<p><code>
en0:10.10.2.1
en0:10.10.2.2
</code></p>
<p>and you have to reboot to enable it.  Also don't forget to edit /etc/hostconfig and set "IPALIASES=-YES-" (I didn't realize I needed to do this and couldn't figure out for a few minutes why my aliases weren't coming up after a reboot).  "man IPAliases.conf" is a good place to look as well.  Finally, note that OS X will get, and use, the DNS name of the <i>last</i> defined IP alias.  I have no idea why, since my computer's name is "fenris", why the shell prompt and "hostname" were giving me the name "dns", which happens to be the DNS name of the last IP defined in /etc/IPAliases.conf.  However, if the name reported by hostname is important, use one of the aliases in the Network settings of System Preferences and put the IP address that belongs to the DNS name (A record, please) as the last IP alias.  There's also no "eth0:0" or "eth0:1" so you can't just shut off one alias and add another on-the-fly like you can in Linux.  all IPs are assigned to the associated ethernet device, so in my case if I were to do "/sbin/ifconfig en0" you'd see all five associated IP addresses.</p>
<p>That was probably the weirdest thing to deal with, besides file location differences.</p>
<p>Oh, and system-wide cron stuff.  Normally I drop a script or symlink to a script in /etc/cron.daily/, but OS X uses periodic instead.  It's not very different, so just create the script/symlink in /etc/periodic/daily/ instead and it will be run with the daily system jobs (i.e. I created /etc/periodic/daily/900.svn-verify to execute the daily script I run to verify the integrity of my subversion repositories).  The only real difference here against cron on a Linux system is that unless you redirect output to /dev/null, the output of cron scripts gets emailed to you (well, if you provide an email address).  Not so with periodic, at least not by default.  I assume there must be a way to do it, but my daily output, instead of coming to my inbox, went into /var/log/daily.out instead.  I don't like that since I want to have delivered to me notification that my svn repos need repair; I don't want to have to remember to look at the file.  I need to look into this further... I suspect it shouldn't be too difficult, but I'm not familiar with periodic at all.</p>
<p>And finally, LDAP authentication.  On my network, I use LDAP authentication on all the Linux workstations and vmware images just because it makes it easier on me.  I've not had much luck getting OS X workstations to authenticate against my Linux-based LDAP directory, so with Open Directory on OS X server, it's quite easy to make it work with OS X workstations.  I also found out it was quite easy to do with Linux as well and didn't really take much to change it (since Open Directory is based on OpenLDAP).  A few minor tweaks to my /etc/ldap.conf file and I was up and running.  The only thing I had to remember was that OD exports the home information as being /Users/foo, instead of /home/foo.  This is easy enough to remedy, by either making /Users a symlink to /home, or moving /home to /Users.  For anyone interested, my /etc/ldap.conf for Mandriva looks like this:</p>
<p><code></p>
<h1>ldap.conf for authentication against OpenDirectory</h1>
<p>host fenris.annvix.ca
base dc=fenris,dc=annvix,dc=ca
ldap version 3
scope one
pam_filter objectclass=posixAccount
pam_login_attribute uid
pam_password crypt
nss_base_passwd cn=users,dc=fenris,dc=annvix,dc=ca?one
nss_base_shadow cn=users,dc=fenris,dc=annvix,dc=ca?one
nss_base_group cn=groups,dc=fenris,dc=annvix,dc=ca?one</p>
<h1>ssl start_tls</h1>
<p>ssl off</p>
<h1></h1>
<h1>OpenDirectory home directories are /Users/foo, so create</h1>
<h1>a /Users directory and symlink appropriate /home directories</h1>
<h1>there (or rename /home to /Users)</h1>
<h1></h1>
<h1>everything else is configured the same as if using a LDAP auth source</h1>
<p></code></p>
<p>Yeah, I have to figure out the SSL/TLS stuff in Open Directory yet.  There's also some kerberos stuff in there I'm thinking of playing with to make everything single-signon.  But that will come later.  For my home network, this is sufficient, and it works.</p>
<p>The only thing left to do now is the VPN stuff, but I'll do that this weekend when I can go to my dad's and borrow his internet connection to see if it works.</p>
<p>Anyways, as of right now my Mandriva LAN server is temporarily off and I'm going to be using the OS X server for the next week or two, to make sure there are no surprises.  That way, next month when I have to do mostly the same thing for a client, there won't be (too many) surprises.  So is OS X server worse than Linux?  Not really.  They're both pretty much the same.  Those who like GUI configs will like OS X server... the Server Admin and Workgroup Manager tools are really quite nice.  For someone like me who developed Annvix without a GUI, I don't much care, and the (compared to Linux) non-standard location for files was frustrating and trying.  There's obviously a lot to fiddle with yet, but the basic services are up and running which is what I need.  When this thing has a few services turned off so my Mandriva server can once again resume it's duties, it'll be left around for a debugging/reference platform as it's always nicer to muck up your own stuff instead of a client's.</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2008-07-11T17:47:00-06:00">Fri 11 July 2008</time>
            <h4>Category</h4>
            <a class="category-link" href="https://vdanen.github.io/categories.html#macos-ref">Macos</a>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://twitter.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://github.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/vdanen/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://infosec.exchange/@vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mastodon" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%"/><path d="m409 290c-5 24-43 50-85 56-86 11-137-6-137-6 3 13-4 54 70 52 31 0 58-7 58-7l2 27c-51 24-107 15-140 6-67-17-79-90-81-162v-59c0-74 49-96 49-96 50-24 180-22 222 0 0 0 49 22 49 96 0 0 1 55-7 93" fill="#3088d4"/><path d="m358 202v91h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://vdanen.github.io/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>