<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/custom.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/fontawesome.min.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta name="description" content="I’ve taken the last week of June “off” from doing updates to look into RSBAC and AppArmor because I’m not convinced that the Mandriva implementation of RSBAC will be user-friendly or transparent, nor very “out-of-the-box”. This was the result of my asking why we are persisting with RSBAC …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", Linux, " />

<meta property="og:title" content="RSBAC and AppArmor "/>
<meta property="og:url" content="https://annvix.com/blog/rsbac-and-apparmor" />
<meta property="og:description" content="I’ve taken the last week of June “off” from doing updates to look into RSBAC and AppArmor because I’m not convinced that the Mandriva implementation of RSBAC will be user-friendly or transparent, nor very “out-of-the-box”. This was the result of my asking why we are persisting with RSBAC …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2006-07-04T09:40:00-06:00" />
<meta name="twitter:title" content="RSBAC and AppArmor ">
<meta name="twitter:description" content="I’ve taken the last week of June “off” from doing updates to look into RSBAC and AppArmor because I’m not convinced that the Mandriva implementation of RSBAC will be user-friendly or transparent, nor very “out-of-the-box”. This was the result of my asking why we are persisting with RSBAC …">

        <title>RSBAC and AppArmor  · Annvix
</title>
        <link rel="shortcut icon" href="https://annvix.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://annvix.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://annvix.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://annvix.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://annvix.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://annvix.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://annvix.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://annvix.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://annvix.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://annvix.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://annvix.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://annvix.com/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5JGVD90SKJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5JGVD90SKJ');
</script>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://annvix.com/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://annvix.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://annvix.com/about">About</a></li>
                                <li ><a href="https://annvix.com/documentation">Documentation</a></li>
                                <li ><a href="https://annvix.com/categories">Categories</a></li>
                                <li ><a href="https://annvix.com/tags">Tags</a></li>
                                <li ><a href="https://annvix.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://annvix.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://annvix.com/blog/rsbac-and-apparmor">
                <span class="caps">RSBAC</span> and&nbsp;AppArmor
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>I&#8217;ve taken the last week of June &#8220;off&#8221; from doing updates to look into <span class="caps">RSBAC</span> and AppArmor because I&#8217;m not convinced that the Mandriva implementation of <span class="caps">RSBAC</span> will be user-friendly or transparent, nor very &#8220;out-of-the-box&#8221;.  This was the result of my asking why we are persisting with <span class="caps">RSBAC</span> (which can be complicated and very intrusive for a desktop system) when AppArmor is available and it&#8217;s a lot easier to configure and use.  The answer I got was &#8220;we have two months until betas approx and now is too late to change technologies&#8221;.  Well, to be blunt, I don&#8217;t buy this at all.  I know that Thierry is working on a drak tool for configuring <span class="caps">RSBAC</span>, but knowing how short-sighted we can be at Mandriva at times, I wanted more details.  The bottom line was there would be a tool to configure <span class="caps">RSBAC</span>, but no default policies shipped (which means no &#8220;out-of-the-box&#8221; <span class="caps">RSBAC</span> support nor, I&#8217;m suspecting, <span class="caps">RSBAC</span> being enabled by&nbsp;default).</p>
<p>This poses two problems for me.  One, if we don&#8217;t have sensible defaults, the end user has nothing to build up from&#8230; everything is done from scratch.  This is ok for the &#8220;hackers&#8221; who like to fiddle, but people like me who just want to <i>use</i> the computer will have to invest a few hours in learning how to configure <span class="caps">RSBAC</span> properly and then testing/debugging to make sure the policies don&#8217;t break things.  The other problem is that if <span class="caps">RSBAC</span> isn&#8217;t enabled by default, how many people will know it exists, and how many will actually enable it?  And once they find out they need to configure it themselves, how many will then promptly turn it off or, worst-case-scenario, enable it, not have it configured, and then not be able to log&nbsp;in?</p>
<p>The following is my analysis of how we (Mandriva) should proceed with <span class="caps">RSBAC</span> and if or whether we should use AppArmor and what the <span class="caps">TTD</span> (Time To Deliver) would be for both technologies, and what would be involved, as well as the pro&#8217;s and con&#8217;s of both technologies.  Considering I&#8217;ve only taken a week (and can&#8217;t really invest more time into this at the moment or risk the wrath of Stew), this may not be 100% accurate and it certainly isn&#8217;t complete, but this is the findings I&#8217;ve found so&nbsp;far.</p>
<p>And rather than post a long message for discussion on the maintainers@ mailing list, and cc&#8217;ing the kernel team, I decided to put this here to get a little more exposure and a reference point for&nbsp;everyone.</p>
<p>First, let&#8217;s look at a few of the issues that concern <span class="caps">RSBAC</span> and AppArmor independantly, without looking <span class="caps">AT</span> what we need to do as a distribution to successfully ship a &#8220;hardening technology&#8221;, be it <span class="caps">RSBAC</span>, AppArmor, or both.  Then we&#8217;ll get into the Mandriva-specific&nbsp;stuff.</p>
<p>First off, there seems to be a misconception that AppArmor and <span class="caps">RSBAC</span> are similar technologies.  They are similar in some respects, true, but they are very different as well.  First off, <span class="caps">RSBAC</span> is an &#8220;overall&#8221; hardening solution.  It has a lot of very cool and very neat features, and the nice thing is that it&#8217;s modular so it&#8217;s not an &#8220;all or nothing&#8221; system.  <span class="caps">RSBAC</span>&#8217;s <span class="caps">AUTH</span>, <span class="caps">ACL</span>, <span class="caps">MAC</span>, and other technologies are great for really restricting the capabilities of various programs and processes.  <span class="caps">RSBAC</span> even has an in-kernel authentication system that replaces traditional shadow password management, which is cool.  Obviously, I don&#8217;t believe it is Mandriva&#8217;s goal to enable and provide all of these features.  Even Annvix, which is security-oriented, has no plans to enable all of these features, so it stands to reason that Mandriva won&#8217;t be going the extra mile to have a full <span class="caps">RSBAC</span>-provisioned system.  Which is fine.  <span class="caps">RSBAC</span> is an overall hardening and securing solution that is proven and reliable.  Unfortunately, the <span class="caps">RSBAC</span> docs are geared primarily to <span class="caps">RSBAC</span> developers.  In other words, <span class="caps">RSBAC</span> documentation is shit for the average&nbsp;joe.</p>
<p>AppArmor, on the other hand, has a lot of really great docs.  And it isn&#8217;t a &#8220;system-hardening&#8221; system.  AppArmor is more of an application firewall.  It restricts and allows certain capabilities of files and programs.  The documentation even suggests that AppArmor is not really useful for securing all applications, but primarily &#8220;forward-facing&#8221; programs, and by this I mean network-enabled services that interact with humans and have a high probability that if there is something wrong with the app, it can be contained to operating on certain levels.  For instance, if a problem exists in Apache that allows an attacker to view any file on the system that user apache has access to, using AppArmor we can prevent Apache from looking anywhere beyond it&#8217;s configuration files and web data.  We can prevent it from looking randomly in /etc (like /etc/passwd, etc.) with some basic&nbsp;policies.</p>
<p>One distinct disadvantage to <span class="caps">RSBAC</span> is the lack of easy-to-use tools, but this is where the drak tool comes in.  The drak tool will, presumably, make it easy to create, manipulate, and delete policies.  This is important because <span class="caps">RSBAC</span>&#8217;s configuration is database-driven to the extent that it&#8217;s not easily manipulated by &#8220;human hands&#8221;.  On the other hand, AppArmor uses a series of text files to configure itself which can be edited by vim, or any other text editor on the system provided you have sufficient privilege to edit the file.  This does, of course, make the policies more susceptible to tampering, but good use of permissions and ACLs could reduce this&nbsp;probability.</p>
<p>As well, with <span class="caps">RSBAC</span>, you can make root as privileged as user joe meaning that root can have as much, or as little, privilege as you like.  No such provision exists with AppArmor, meaning you need to realize root is still all-powerful and no amount of permission manipulation and ACLs will prevent someone who has gotten root privileges from borking your system.  The goal, then, is to make sure that no one can get root privs in the first place.  This is much easier to achieve if the system is a single-user system or a trusted multi-user system (like most desktops and/or home computers, and possibly office computers as well).  This is a little tricker to accomplish on a server, but it can be done.  <span class="caps">RSBAC</span> provides even better options to achieve this goal, but it doesn&#8217;t mean it&#8217;s impossible to do <i>without</i> <span class="caps">RSBAC</span>.  For instance, simple no-brainers like using <span class="caps">SSH</span> keys, appropriate firewall settings, etc. go a lot further to protect a system than some people realize.  None of them are silver-bullets on their own, but each add another defensive layer making it more difficult to appropriate unauthorized access or privilege on a system and, after all, there is no such thing as a fully secured system&#8230; everything we do is just adding layers to our &#8220;defense-in-depth&#8221; to make it as difficult as possible for someone to get anywhere they&#8217;re not supposed&nbsp;to.</p>
<p>Finally, as was pointed out to me by some kernel developers and some <span class="caps">LKML</span> messages I read, the big perceived disadvantage to AppArmor is that it is path-based whereas other solutions (the <span class="caps">LKML</span> context was SELinux, rather than <span class="caps">RSBAC</span>, but the points are the same) take an inode-based approach.  The concern here is that someone can take, say, /bin/foo which has some AppArmor policy applied to it, hardlink it, then execute the hardlinked copy without any policy protection.  This too can be avoided for the most part with some decent filesystem mount options.  I say for the most part&#8230; it may not be foolproof.  Using the inode, of course, presents it&#8217;s own challenges which will look at in a&nbsp;bit.</p>
<p>Now that we&#8217;ve had a brief look at both AppArmor and <span class="caps">RSBAC</span>, I&#8217;ll address a few&nbsp;points.</p>
<p>The first is the drak tool, and the <span class="caps">TTD</span>.  Apparently we have two months to deliver this.  Which is wierd considering the decision to use <span class="caps">RSBAC</span> was made last year, <span class="caps">AFAIK</span> <span class="caps">RSBAC</span> support has been in the kernel since last year, the rsbac-admin tools have been in cooker since last year (in fact, they&#8217;re in the 2006 release), but the tool is &#8220;in the&nbsp;works&#8221;.</p>
<p>So if we use <span class="caps">RSBAC</span>, the assumption is we need a tool to configure it.  If we switched to AppArmor we&#8217;d need a tool too.  So either way, a tool needs to be written.  My understanding is it&#8217;s currently being worked on, but isn&#8217;t done.  So there might be a bit of a time-loss based on what&#8217;s already been done, but I think the end result of a tool geared towards AppArmor versus one geared towards <span class="caps">RSBAC</span> would take less time.  For one, the <span class="caps">RSBAC</span> tool will be far more complicated due to how <span class="caps">RSBAC</span> handles it&#8217;s configuration data.  With an AppArmor tool, you just need to manipulate plaintext files.&nbsp;Easy.</p>
<p><span class="caps">RSBAC</span>, on the other hand, requires more work.  For one, you need to either obtain all the configuration data from the rsbac.dat database in realtime to allow the user to manipulate them or you need to maintain a private plaintext copy of this that the tool can read and write.  Also remember <span class="caps">RSBAC</span> privilege; if a user makes it so that root can&#8217;t execute <span class="caps">RSBAC</span>-related commands, then presumably root won&#8217;t even be able to configure <span class="caps">RSBAC</span> with our tool (the preferred method of configuring <span class="caps">RSBAC</span> is to use the secoff (or uid 400) user).  So then we need to make our tool run as user secoff, which means we at the <i>least</i> need an <span class="caps">RSBAC</span> policy to permit this, or use sudo/su to do it (but, again, a default policy would need to be in place to permit this).  Already the complexity is&nbsp;increasing.</p>
<p>So let&#8217;s assume for the moment that we maintain our own private text configuration for all <span class="caps">RSBAC</span> policies and commands.  The advantages are this is easy to parse, easy to write, and then a backend process could be used to take that data and apply all the policies appropriately.  This could be a good thing, but it also precludes the use of normal <span class="caps">RSBAC</span> <span class="caps">CLI</span> tools because if a user makes changes on their own, our configs will be out of sync.  <span class="caps">FWIW</span>, this is how <span class="caps">MNF</span> handles it&#8217;s configuration and I think it&#8217;s a piss-poor way of doing it because you force the user to either a) use the tool exclusively or b) use the <span class="caps">CLI</span> tool(s) exclusively.  There is no middle ground because if you configure something with the tool, make changes with the <span class="caps">CLI</span>, the next invocation of the tool overwrites everything.&nbsp;Yuck.</p>
<p>So for our tool to be effective it needs to read data out of the <span class="caps">RSBAC</span> database, something that I&#8217;m assuming can only be done by secoff.  (Note, a lot of this assumption, I haven&#8217;t actually attempted to configure <span class="caps">RSBAC</span> in this way to test this theory, so some of this could be flat-out wrong, but I don&#8217;t think it&#8217;s too far off the mark).  So our root-executed tool then needs to have privileges to get the data from user secoff (default policies again), then needs to manipulate the configuration as the user is changing/adding/deleting stuff (probably using a temporary configuration file of some sort), and then the tool needs to take the final changed configuration set, hand it off to secoff which would then run another tool to reapply all the&nbsp;policies.</p>
<p>If you&#8217;re paying attention, you&#8217;ll see that not only does there need to be multi-user interaction (root and secoff), but all of a sudden we&#8217;re using two tools now.  One is the <span class="caps">GUI</span> configuration tool, the other is the &#8220;policy applicator&#8221; tool.  There would probably need to be a &#8220;policy extractor&#8221; tool as well.  Three&nbsp;tools.</p>
<p>But here is where it becomes more interesting.  Remember the whole &#8220;inode is better than path-based&#8221; argument I noted above?  Remember the kernel developers telling me this was a good thing, trying to tout the whole &#8220;inode is better for security&#8221; drivel?  In theory this is great, and in practice for a well-supervised system this may be true.  But for a moving target (remember, <span class="caps">RSBAC</span> is to go into 2007, a desktop system, not Corporate Server 4 or a similar server/slightly-hardened system), like  a desktop, this isn&#8217;t as useful, nor as easy to deal&nbsp;with.</p>
<p>A little illustration should indicate my&nbsp;point:</p>
<pre>
[root@ares tmp]# echo foo >1; echo "1 is inode `ls -i 1`"; \
echo bar >2; rm -f 1; echo cat >3; echo foo2 >1; \
echo "1 is inode `ls -i 1`"; echo "2 is inode `ls -i 2`"; \
echo "3 is inode `ls -i 3`"
1 is inode 4349024 1
1 is inode 4349026 1
2 is inode 4349025 2
3 is inode 4349024 3
</pre>

<p>What this little bit of silliness is doing is replicating what could/would happen during an <span class="caps">RPM</span> upgrade.  You&#8217;ll notice we created &#8220;1&#8221; first then checked it&#8217;s inode, then we created &#8220;2&#8221;, deleted &#8220;1&#8221;, created &#8220;3&#8221;, then created &#8220;1&#8221; again.  You can see that the end result is that file &#8220;3&#8221; obtained the original file &#8220;1&#8220;&#8216;s&nbsp;inode.</p>
<p>That&#8217;s nice, but rather meaningless unless you put it into context.  Assume &#8220;1&#8221; is /bin/login.  You have a system-wide default to disallow the use of /bin/login by anyone, then an exception to allow user joe to use it.  If /bin/login is replaced and it&#8217;s inode changes, then the policy on /bin/login is now applied to a different file (or an unclaimed inode).  So /bin/login has the system-wide default on it, which is to disallow logins.  Well now no one, including joe, can login.  This could be used for any single file with a specific capability, <span class="caps">ACL</span>, or other policy applied to it.  Note that AppArmor, with it&#8217;s (ridiculed) path-based approach wouldn&#8217;t care about this.  /bin/login is /bin/login, regardless of the inode.  The AppArmor policies would continue to&nbsp;apply.</p>
<p>Speaking with the <span class="caps">RSBAC</span> developers and others on freenode, they indicated that in a situation like that, they just re-applied their policies.  Or, as one fellow said, he would reboot into a maintenance kernel, re-apply the policy (since he wasn&#8217;t able to do it on his regular <span class="caps">RSBAC</span>-enabled kernel), then reboot&nbsp;again.</p>
<p>I ask you&#8230; is this is a good thing to ask the user to do when, say, Evolution gets updated?  How about Firefox?  Hell, Windows doesn&#8217;t even require a reboot when you upgrade&nbsp;firefox!</p>
<p>This isn&#8217;t really an option, as far as I&#8217;m concerned.  So the sensible thing would be to have a working copy of the policies (these fellows have a shellscript to apply policies&#8230; remember writing your own iptables/ipchains firewall rules in &#8220;firewall.sh&#8221;?  same idea applies).  With a copy of these policies we can hack rpm to, in some way, execute at the end of every single rpm installation transaction the policies.  I suppose it could be done after every installation (ie. urpmi install, so after a group of rpms), but that could possibly cause issues, even if they&#8217;re temporary because polciies might be in flux and a package requiring a protected file may be invoked which was previously installed/upgraded and may have a misapplied policy).  Ideally, running the policy after every sole rpm installation would be good, but the overhead might not be appealing.  A trade off might be to hack urpmi instead, to have it run the &#8220;policy re-applicator&#8221; after every invocation.  But then the same hack needs to be done for apt, smart, rpmdrake, etc.  Either way, something needs to be done so that after an rpm transaction, the policies can be re-applied, automatically, so as to be transparent to the end user.  Now, this &#8220;policy re-applicator&#8221; could be the same app used by the drak tool to reapply policies after&nbsp;changes.</p>
<p>But because here we don&#8217;t have the advantage of runing drakbac (or whatever the tool will be called), we need to <i>get</i> those policies first.  This means that after every rpm or urpmi/smart/apt/rpmdrake invocation we would need to execute our policy extractor to get the policies, then use that to re-apply them with the policy re-applicator.  Or we&#8217;re looking back to our private <span class="caps">RSBAC</span> configuration file again so we don&#8217;t have to go through the process of extracting the policies each&nbsp;time.</p>
<p>And don&#8217;t forget that this stuff will need to be done via secoff, which means that (again) default policies need to be in place for rpm or urpmi/smart/apt/rpmdrake to be able to use secoff to a) get and b) apply the&nbsp;policies.</p>
<p>My head is starting to hurt, so let&#8217;s switch gears and look at AppArmor in this case.  With AppArmor, you run your tool, configure it (manipulating plaintext files as root), and then you issue a &#8220;service apparmor reload&#8221; to re-read the plaintext configs and apply the new policies.  Wait&#8230; that&#8217;s it?  Everything can be done as root?  One tool?  One simple command to reload the&nbsp;policies?</p>
<p>Yup.</p>
<p>Think again to the <span class="caps">TTD</span> on all of this.  Remember we have 2 months.  Do you honestly think that in 2 months we can hack out a series of tools and changes to package managers to manage <span class="caps">RSBAC</span>?  Or do you think it more realistic to create one tool for AppArmor?  Seriously, if this would have been looked at when the decision was made to use <span class="caps">RSBAC</span> instead of SELinux, a lot of this could have been done by&nbsp;now.</p>
<p>Now, in all fairness, I believe the <span class="caps">RSBAC</span> stuff is doable, even with all the goofiness I outlined above.  SELinux is inode based as well.  And it&#8217;s being used in Fedora and <span class="caps">RHAS</span> or <span class="caps">RHES</span> or whatever <span class="caps">RH</span> calls their server product.  I suspect they came across these same (or similar) issues and managed them as well.  So it is probable that the same approach taken for SELinux support could be applied here.  For all I know, this capabilitity is available in SELinux or some user-land SELinux patches for rpm and/or other programs.  I don&#8217;t know&#8230; I&#8217;ve never actually looked at SELinux&nbsp;before.</p>
<p>I think a compromised solution could be done.  As I said, I&#8217;ve spent this week reading, playing, and looking around at this stuff.  Because I find the Mandriva kernel extremely painful to work on, I put 2.6.16.22 into Annvix, and added both <span class="caps">RSBAC</span> <i>and</i> AppArmor, together, in the kernel.  Because I don&#8217;t much patch the Annvix kernel, these patches are the <i>only</i> patches for the kernel.  Both apply, together, without rejects.  So it should be possible to do the same thing with the Mandriva&nbsp;kernel.</p>
<p>I&#8217;ve also been running this kernel for a few days, with AppArmor enabled and running, and with some <span class="caps">RSBAC</span> features enabled.  The features I disabled were <span class="caps">UM</span> (the user mangement stuff), the <span class="caps">NET</span>, <span class="caps">AUTH</span>, <span class="caps">RC</span>, <span class="caps">ACL</span>, <span class="caps">MAC</span>, <span class="caps">PM</span>, and <span class="caps">PAX</span> options.  I enabled the <span class="caps">CAP</span>, <span class="caps">JAIL</span>, <span class="caps">DAZUKO</span>, and <span class="caps">FF</span> features.  In other words, I&#8217;m using the more minor features of <span class="caps">RSBAC</span> and not the heavy lifting stuff that would interfere with me using the kernel without a lot of pre-configuration.  Some of the options I disabled could probably be enabled without conflict; I didn&#8217;t try&nbsp;however.</p>
<p>Now, my point here is that the two <i>can</i> co-exist.  We could let AppArmor do the &#8220;application firewall&#8221; work because, quite frankly, it&#8217;s the easiest and most transparent solution to the end user.  It&#8217;s also the easiest for the end-user to use.  And since Mandriva is not a rock-solid-ultra-secure distro, the fact that we&#8217;re using AppArmor for this as opposed to <span class="caps">RSBAC</span> won&#8217;t be a bad thing.  Honestly, I&#8217;ll take common sense here.  We could enable AppArmor, with default profiles, and have it running on first boot.  Everyone would use it.  We could use <span class="caps">RSBAC</span>, likely not have it enabled in every kernel (kernel-secure perhaps?) and have maybe 20% of our users using it (probably a generous figure).  If, as was indicated, we have no default policies to begin with and essentially warn the users they have an investment of a few hours to a few days depending on their proficiency, how many of those users will then disable <span class="caps">RSBAC</span>?  I&#8217;m guessing at least&nbsp;50%.</p>
<p>That leaves us with, optimistically, 10% of our users who will a) enable and b) configure <span class="caps">RSBAC</span> then c) use it.  Makes you wonder if it&#8217;s even worth&nbsp;it.</p>
<p>The other thing to consider here is if, as I was told, we provide the <span class="caps">RSBAC</span> tool and <span class="caps">RSBAC</span> support in the kernel, but do not enable it out of the box and do not provide default policies, we can only consider ourselves a security technology <i>provider</i>.  We cannot, by any means, call ourselves a security technology <i>solution</i>.  Fedora and <span class="caps">RH</span> can call themselves a <i>solution</i> because SELinux is enabled, with default policies, out of the box (although I believe you can turn SELinux support off during install).  Novell can call itself a <i>solution</i> because AppArmor is running out of the&nbsp;box.</p>
<p>We can call ourselves a <i>provider</i> or <i>enabler</i>, nothing more.  Which looks rather sad compared to the security <i>solutions</i> out there.  In fact, I was told that putting <span class="caps">RSBAC</span> into the kernel was a &#8220;value added service&#8221; (in the context of not having any default policies or &#8220;out-of-the-box&#8221;-ness to go with it).  I don&#8217;t believe this is true at all.  There is no value to something that such a minority (the optimistic 10%) will use, but which we will have to maintain.  There is no value to pre-packaged rsbac-admin tools that are useless by themself.  Until I argued against it, the SELinux tools were provided in cooker with no SELinux support in the kernel.  This is like that.. we might as well say that providing the SELinux libraries and user-space tools is &#8220;value added&#8221; because the user only has to patch and recompile the kernel and not compile the userspace tools.  Unless the definition of &#8220;value added&#8221; has changed recently, this isn&#8217;t&nbsp;it.</p>
<p>At the end of the day, I&#8217;ve got <span class="caps">RSBAC</span> and AppArmor running together here.  I&#8217;ve got the AppArmor packages Annvix-ized (which means it would take me 5 minutes to adapt them for Mandriva).  The kernel team could probably apply the AppArmor patches, in conjunction with the <span class="caps">RSBAC</span> patches, fairly easily.  Default AppArmor policies could be generated for most important apps in a matter of days (and by important I&#8217;m talking about servers (forward-facing apps) and networking clients, such as web browsers, email clients&#8230; things that could potentially be abused by malicious remote servers).  I suspect the AppArmor tool would take half the amount of time to write than the equivalent <span class="caps">RSBAC</span> tool (nevermind the other backend/supporting tools also&nbsp;required).</p>
<p>Is it really that difficult to believe that AppArmor could be fully deployed in cooker within 2 weeks?  Whereas we&#8217;d be <i>lucky</i> to have all the things in place for full <span class="caps">RSBAC</span> support within the required 2&nbsp;months?</p>
<p>Anyways, I&#8217;ve done my part and looked into this.  I&#8217;m used to being ignored when it comes to recomendations like this.  I hope this time I&#8217;m not.  If I am, however, this will be here for posterity, and if I&#8217;m not, well, I&#8217;m hoping this could serve as a good roadmap or bitbucket on what challenges would be involved to get full <span class="caps">RSBAC</span> support for Corporate Server 5.&nbsp;=)</p>
<p><b><span class="caps">EDIT</span></b>:  I&#8217;ve been told that we&#8217;re working on default policies to use with <span class="caps">RSBAC</span>, and not necessarily a tool to configure it.  That changes my arguments somewhat about the viability of the out-of-boxness of <span class="caps">RSBAC</span> come Mandriva 2007 (if this is true), but then I&#8217;m hoping someone writes some good docs so the end user knows how to use the existing <span class="caps">CLI</span> tools.  Now, until I can talk to Thierry (I believe he&#8217;s been on holidays the last week or two), we&#8217;ll never know for sure whether the plan is for policies and no tool, or a tool and no policies.  Either way, my argument&nbsp;stands.</p>


             
 
                <p id="post-share-links">
    Share on:
      <a href="https://twitter.com/intent/tweet?text=RSBAC%20and%C2%A0AppArmor&url=https%3A//annvix.com/blog/rsbac-and-apparmor" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
 ❄       <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//annvix.com/blog/rsbac-and-apparmor&title=RSBAC%20and%C2%A0AppArmor&summary=I%E2%80%99ve%20taken%20the%20last%20week%20of%20June%20%E2%80%9Coff%E2%80%9D%20from%20doing%20updates%20to%20look%20into%20RSBAC%20and%20AppArmor%20because%20I%E2%80%99m%20not%20convinced%20that%20the%20Mandriva%20implementation%20of%20RSBAC%20will%20be%20user-friendly%20or%20transparent%2C%20nor%20very%20%E2%80%9Cout-of-the-box%E2%80%9D.%20%20This%20was%20the%20result%20of%20my%20asking%20why%20we%20are%20persisting%20with%20RSBAC%20%E2%80%A6&source=https%3A//annvix.com/blog/rsbac-and-apparmor" target="_blank" rel="nofollow noopener noreferrer" title="Share on LinkedIn">LinkedIn</a>

            
            







            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://annvix.com/blog/so-why-dont-i-like-the-26-kernel-anyways" title="Previous: So why don’t I like the 2.6 kernel anyways?">So why don’t I like the 2.6 kernel anyways?</a></li>
                <li class="next-article"><a href="https://annvix.com/blog/security-vuln-in-anthill" title="Next: Security vuln in Anthill">Security vuln in Anthill</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2006-07-04T09:40:00-06:00">Jul 04, 2006</time>
            <h4>Category</h4>
            <a class="category-link" href="https://annvix.com/categories#linux-ref">Linux</a>
<h4>Stay in touch</h4>
<div id="sidebar-social-link">
    <a href="https://twitter.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://github.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/vdanen/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://infosec.exchange/@vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mastodon" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%"/><path d="m409 290c-5 24-43 50-85 56-86 11-137-6-137-6 3 13-4 54 70 52 31 0 58-7 58-7l2 27c-51 24-107 15-140 6-67-17-79-90-81-162v-59c0-74 49-96 49-96 50-24 180-22 222 0 0 0 49 22 49 96 0 0 1 55-7 93" fill="#3088d4"/><path d="m358 202v91h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Copyright &copy; 2024 Vincent Danen
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://annvix.com/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>