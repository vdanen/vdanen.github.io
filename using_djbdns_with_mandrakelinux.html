<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/custom.css" media="screen">
        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">


<meta property="og:title" content="Using djbdns with Mandrakelinux "/>
<meta property="og:url" content="https://vdanen.github.io/using_djbdns_with_mandrakelinux.html" />
<meta property="og:description" content="Like qmail, djbdns is open source but has a restrictive license which makes distributing it a trifle difficult for many vendors. However, it is distributable in binary form if you follow the license and the packager assures to the best of their ability that the binary package works well and …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2008-03-25T15:22:00-06:00" />
<meta name="twitter:title" content="Using djbdns with Mandrakelinux ">
<meta name="twitter:description" content="Like qmail, djbdns is open source but has a restrictive license which makes distributing it a trifle difficult for many vendors. However, it is distributable in binary form if you follow the license and the packager assures to the best of their ability that the binary package works well and …">

        <title>Using djbdns with Mandrakelinux  · Annvix
</title>
        <link href="https://vdanen.github.io/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://vdanen.github.io/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://vdanen.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://vdanen.github.io/about.html">About</a></li>
                                <li ><a href="https://vdanen.github.io/documentation.html">Documentation</a></li>
                                <li ><a href="https://vdanen.github.io/categories.html">Categories</a></li>
                                <li ><a href="https://vdanen.github.io/tags.html">Tags</a></li>
                                <li ><a href="https://vdanen.github.io/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://vdanen.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="https://vdanen.github.io/using_djbdns_with_mandrakelinux.html"> Using djbdns with Mandrakelinux  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <p>Like qmail, <a rel="nofollow" class="external text" href="http://cr.yp.to/djbdns.html">djbdns</a> is open source but has a restrictive <a rel="nofollow" class="external text" href="http://cr.yp.to/distributors.html">license</a> which makes distributing it a trifle difficult for many vendors. However, it is distributable in binary form if you follow the license and the packager assures to the best of their ability that the binary package works well and conforms to the default and recommended installation instructions from the main site.
</p>
<p>Because of this, MandrakeSoft is unable to ship djbdns directly. However, I have been maintaining a djbdns RPM package since March of 2001 that will run under Mandrakelinux. This does not mean that djbdns is any more difficult to install than any other package for Mandrakelinux. In fact, if you download a special RPM called <b>djbsupport</b>, you will be able to easily install djbdns and other DJB software with a single command.
</p>
<p>For those not sure of what djbdns is, it is a DNS server similar to <a rel="nofollow" class="external text" href="http://www.isc.org/products/BIND/">BIND</a> which is distributed as part of the Mandrakelinux distribution, and many other distributions as well. It is a drop-in replacement for BIND that is much more secure. With the recent and not-so-recent vulnerabilities persistent in the BIND software, many people are looking for alternatives. As well, many others believe that no alternatives exist. They are resigned to running buggy and broken software falsely believing that they don't have a choice. For the longest time perhaps this was the case, but it isn't anymore. The djbdns packages provide a full DNS server (like BIND), and also a caching nameserver (djbdns-extcache and djbdns-localcache) which are replacements for the caching-nameserver package for Mandrakelinux which act as an external or local caching DNS server. If you're not convinced about djbdns' security, you should know that there has never been a verified security hole in djbdns and the author even offers a reward if you find one with his <a rel="nofollow" class="external text" href="http://cr.yp.to/djbdns/guarantee.html">security guarantee</a>.
</p>
<p>The djbdns package is built and maintained by Vincent Danen for use on Mandrakelinux systems. I assure you, the packages were built with a few things in mind: stability, easy configuration, and conforming to the license.
</p>
<p><b>NOTE:</b> I changed <i>one</i> thing in the package that is not standard to the install instructions on the djbdns website. On the website, the default standard location for service files is <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc</span> (ie. <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/dnscachex</span>, <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/tinydns</span>, etc.). To make <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">svc</span> (or the service monitor, which is a part of the daemontools packages) aware of these services, you must symlink <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/tinydns</span> to <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/service/tinydns</span>. I did not think this was appropriate because logging information, configuration information, and so forth is stored in sub-directories beneath these files. It's fine for configuration, but not good for variable and logging data. As a result, <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/tinydns</span> (and the other services like dnscachex and axfrdns) were re-located to a special directory called <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/tinydns</span> (and so on). This makes more sense because <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var</span> is a good place for transient data like logs. Because of this, if you are looking at instructions on the djbdns website, keep in mind that when they talk about <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/tinydns</span>, if you install the RPMs, you should be using <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/tinydns</span>. Likewise, the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/service</span> directory is located in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/service</span>. This was to make it easier to control djbdns as a separate process from other programs using svc, like qmail. However, to retain compatability with the author's distribution license, symlinks are created in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/service</span> for djbdns control, and symlinks are created in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc</span> that point to the appropriate location.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installing_djbdns"><span class="tocnumber">1</span> <span class="toctext">Installing djbdns</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Configuring_djbdns-extcache"><span class="tocnumber">2</span> <span class="toctext">Configuring djbdns-extcache</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Configuring_djbdns-localcache"><span class="tocnumber">3</span> <span class="toctext">Configuring djbdns-localcache</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Configuring_djbdns"><span class="tocnumber">4</span> <span class="toctext">Configuring djbdns</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Resources"><span class="tocnumber">5</span> <span class="toctext">Resources</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installing_djbdns">Installing djbdns</span></h2>
<p>The first step is to decide what you need. There are three djbdns packages available: djbdns is the full DNS server; djbdns-localcache is a caching nameserver for the local machine only; djbdns-extcache is a caching nameserver for external machines. If you want to run an external caching nameserver (ie. use one DNS server for your LAN), you will want to install djbdns-extcache. If you want a caching nameserver for the local host only, then you should install djbdns-localcache. If you want to setup a full DNS server, you will want to install both djbdns and djbdns-localcache. The djbdns package itself does not do any DNS lookups, so the DNS server you are setting up will either have to use an external server for DNS lookups, or a local-only caching nameserver. The reasoning behind this is the author's belief that a full DNS server should never double as an external caching nameserver (unlike BIND and some other DNS server packages). The djbdns and djbdns-extcache packages intentionally conflict because they cannot be used together unless you bind the nameserver to one interface (ie. eth0) and the external caching nameserver to another interface (ie. eth1). Because they are two different services, they will compete for the same interface if you attempt it, and only one service will be able to bind to it.
</p>
<p>The easiest way to install djbdns is to use the <b>djbsupport</b> package that is a simple wrapper for urpmi. You can obtain it from ftp.rpmhelp.net/pub/[version]/djbsupport/. Packages are provided for 7.2, 8.0, 8.0/ppc, and 8.1.
</p>
<p>You don't have to install <b>djbsupport</b> if you don't want to. All it does is execute the following as root:
</p>
<pre>
# urpmi.addmedia qmail ftp://ftp.rpmhelp.net/pub/Mandrake/djbware/[ver]/RPMS \
 with ../base/hdlist.cz
</pre>
<p>Replace [ver] with the version of Mandrakelinux you are using (7.2, 8.0, ppc/8.0, or 8.1). Cooker users can use 8.1.
</p>
<p>Once you have <b>djbsupport</b> installed or have used the above commandline to add ftp.rpmhelp.net to your urpmi mediums, execute:
</p>
<pre>
# rpm -e bind caching-nameserver
# urpmi djbdns
</pre>
<p>Replace djbdns with djbdns-extcache or djbdns-localcache, depending on your needs. This will remove BIND and the caching-nameserver package from your system and will install your selected djbdns package, along with daemontools and ucspi-tcp, which are required to run djbdns.
</p>
<h2><span class="mw-headline" id="Configuring_djbdns-extcache">Configuring djbdns-extcache</span></h2>
<p>The installer should configure djbdns-extcache to work properly on your system. You should only have to start djbdns (<span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">/etc/rc.d/init.d/djbdns start</span>) and point <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/resolv.conf</span> to your IP address to have a fully-functioning caching nameserver. Note that by default it allows connections to any IP addresses in your network (ie. if your IP address is 192.168.5.10, it will allow connections from any 192.168.5.* IP address).
</p>
<p>If you want to change this to further restrict or allow access to your external caching nameserver, you can do so by creating 0 byte files in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/dnscachex/root/ip</span>. For instance, to allow the 192.168.25.* network you would do: <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">touch /var/djbdns/dnscachex/root/ip/192.168.25</span>. If you wanted to allow a single host (let's say 152.12.34.21), you would do: <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">touch /var/djbdns/dnscachex/root/ip/152.12.34.21</span>. You will need to restart djbdns after making this kind of change.
</p>
<h2><span class="mw-headline" id="Configuring_djbdns-localcache">Configuring djbdns-localcache</span></h2>
<p>If you installed djbdns-localcache, you will have a local-only caching nameserver that is pre-configured. All you need to do is edit <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/resolv.conf</span> and tell it to use 127.0.0.1 as the nameserver and then start djbdns.
</p>
<h2><span class="mw-headline" id="Configuring_djbdns">Configuring djbdns</span></h2>
<p>When you install djbdns for the full DNS server, the installer makes a few educated guesses to configure your system. It will not work right out of the box, however! You will need to configure it further on your own to ensure it works properly. We will take a look at those steps and how to accomplish them with these RPMs. The instructions are basically the same as the <a rel="nofollow" class="external text" href="http://cr.yp.to/djbdns/frombind.html">Upgrading from BIND</a> pages written by the author.
</p>
<p>The installer will set your system up with some defaults. It will try to obtain your system's internet IP address from eth0 and configure tinydns with it. If this is not correct, you will need to remove the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/tinydns</span> directory and re-create it with the proper IP address by using:
</p>
<pre>
# /usr/bin/tinydns-conf tinydns dnslog
# /var/djbdns/tinydns [your_IP_address]
</pre>
<p>You will need to do the same for axfrdns (which negotiates zone transfers) by removing the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/axfrdns</span> directory and re-creating it with the proper IP address by using:
</p>
<pre>
# /usr/bin/axfrdns-conf axfrdns dnslog /var/djbdns/axfrdns
# /var/djbdns/tinydns [your_IP_address]
</pre>
<p>You can also define what systems are allowed to perform zone transfers on your system. This is accomplished by editing the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/axfrdns/tcp</span> file. By default it looks something like this:
</p>
<pre>
192.168.1.12.:allow
:allow,AXFR=
</pre>
<p>The installer uses the IP address of eth0 in the place of the 192.168.1.12 address noted in the example. If that IP address is incorrect, you will need to modify the file and then recompile the hash database by issuing:
</p>
<pre>
# cd /var/djbdns/axfrdns
# make
</pre>
<p>If you are running a network and replacing two BIND servers (a primary and secondary), you can do the same with djbdns. Install the RPMs on both systems and chose which will be the primary. On the primary nameserver, edit the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/tinydns/root/Makefile</span> file. By default, the commands to perform zone transfers from the primary to secondary servers is disabled. djbdns uses rsync over ssh to perform the transfer. This is odd, but efficient. Uncomment the following lines in the Makefile and change the IP address as appropriate:
</p>
<pre>
remote: data.cdb
       rsync -az -e ssh data.cdb 192.168.1.13:/var/djbdns/tinydns/root/data.cdb
</pre>
<p>Change the above example 192.168.1.13 IP address to that of your secondary DNS server. Now, whenever you run <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">make remote</span> it will transfer the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">data.cdb</span> file (which is the compiled data file) to your secondary server. To automate this, edit your <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/cron.daily/djbdns</span> cronjob file and uncomment the following line:
</p>
<pre>
#make remote &gt;/dev/null
</pre>
<p>Now every day the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">data.cdb</span> file will be sent to your secondary nameserver.
</p>
<p>On the secondary nameserver system, edit the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/djbdns/tinydns/root/Makefile</span> file and make sure it contains only the "9" number in the file. This tells make to exit. You need to do this to ensure make doesn't change the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">data.cdb</span> file since it is generated on the primary system.
</p>
<p>The final step is to start djbdns itself. For more configuration techniques, refer to the djbdns web resources.
</p>
<p>Finally, you can start djbdns by using:
</p>
<pre>
# /etc/rc.d/init.d/djbdns start
</pre>
<p>After configuration, you should have a fully working DNS server. At this point, you should have removed BIND from your system and are able to enjoy a nice and secure DNS server instead, without the fear of compromise usually attributed to those running BIND. =) Man pages are included in the package and are located in the standard man page locations (<span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/usr/share/man</span>).
</p>
<h2><span class="mw-headline" id="Resources">Resources</span></h2>
<p>Here are a few resources to help you configure DNS data with djbdns (as the configuration files are quite different from BIND):
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://cr.yp.to/djbdns.html">djbdns homepage</a></li>
<li> <a rel="nofollow" class="external text" href="http://cr.yp.to/djbdns/tinydns-data.html">tinydns data structure</a></li>
<li> <a rel="nofollow" class="external text" href="http://www.djbdns.org/">A third-party djbdns homepage</a></li>
<li> <a rel="nofollow" class="external text" href="http://www.lifewithdjbdns.org/">Life with djbdns</a></li></ul>
            







        </div>
    </div>
    </article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://vdanen.github.io/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>