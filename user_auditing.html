<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/custom.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://vdanen.github.io/theme/css/fontawesome.min.css" media="screen">
        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta name="description" content="Auditing user accounts is just as important as auditing other parts of your system. In fact, in large multi-user environments, it can be one of the most critical aspects of monitoring your system to prevent attack. For instance, if a user were to leave the company and the account was …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">


<meta property="og:title" content="User Auditing "/>
<meta property="og:url" content="https://vdanen.github.io/user_auditing" />
<meta property="og:description" content="Auditing user accounts is just as important as auditing other parts of your system. In fact, in large multi-user environments, it can be one of the most critical aspects of monitoring your system to prevent attack. For instance, if a user were to leave the company and the account was …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2008-03-25T11:51:00-06:00" />
<meta name="twitter:title" content="User Auditing ">
<meta name="twitter:description" content="Auditing user accounts is just as important as auditing other parts of your system. In fact, in large multi-user environments, it can be one of the most critical aspects of monitoring your system to prevent attack. For instance, if a user were to leave the company and the account was …">

        <title>User Auditing  · Annvix
</title>
        <link rel="shortcut icon" href="https://vdanen.github.io/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://vdanen.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://vdanen.github.io/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://vdanen.github.io/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://vdanen.github.io/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://vdanen.github.io/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://vdanen.github.io/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://vdanen.github.io/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://vdanen.github.io/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://vdanen.github.io/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://vdanen.github.io/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://vdanen.github.io/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5JGVD90SKJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5JGVD90SKJ');
</script>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://vdanen.github.io/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://vdanen.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://vdanen.github.io/about">About</a></li>
                                <li ><a href="https://vdanen.github.io/documentation">Documentation</a></li>
                                <li ><a href="https://vdanen.github.io/categories">Categories</a></li>
                                <li ><a href="https://vdanen.github.io/tags">Tags</a></li>
                                <li ><a href="https://vdanen.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://vdanen.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="https://vdanen.github.io/user_auditing"> User&nbsp;Auditing  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Finding_Accounts_Without_a_Password"><span class="tocnumber">1</span> <span class="toctext">Finding Accounts Without a Password</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Finding_Accounts_with_UID_0_.28aka_SuperUser.29"><span class="tocnumber">2</span> <span class="toctext">Finding Accounts with <span class="caps">UID</span> 0 (aka SuperUser)</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Viewing_Login_History"><span class="tocnumber">3</span> <span class="toctext">Viewing Login History</span></a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            <p>Auditing user accounts is just as important as auditing other parts of your system. In fact, in large multi-user environments, it can be one of the most critical aspects of monitoring your system to prevent attack. For instance, if a user were to leave the company and the account was never removed, who would notice that the account was compromised if it did in fact become compromised? Certainly not the user in question; they are no longer with the company nor are they using the account. In a worst case scenario, the employee themself could be accessing their old account, obtaining informaiton they should no longer have access to. Perhaps providing that information to their new employer, or a competitor.
</p>
<p>The most important thing to do is to keep an eye on accounts on your system and remove those that are no longer being used. Not only will this prevent former employees from accessing systems and data they no longer have a right to access, but it reduces the number of accounts an outside attacker can attempt to gain access through. Remaining vigilant in regards to system accounts that need to be there, and those that need to be removed, is a positive step in securing access to your network and computers.
</p>
<p>There are a number of steps that can be taken to audit user accounts on your system; here he will take a look at them.
</p>

<h2><span class="mw-headline" id="Finding_Accounts_Without_a_Password">Finding Accounts Without a Password</span></h2>
<p>An account without a password is an extremely bad account. A password is the basic form of protecting an account from abuse, and without one, an account can (and will) be compromised quickly. The only exception to the rule here is system accounts that cannot be logged into. The following command will detect accounts without passwords using <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/shadow</span>, or the shadow password file:
</p>
<pre>
# awk -F: '$2 == "" { print $1 }' /etc/shadow
</pre>
<p>Because the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">shadow</span> file is only readable by root, root must execute the command. Because the second field of each entry in the <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">shadow</span> file is a password, we can quickly detect those accounts without a password using <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">awk</span> (the <span style="font-family: courier; color: #7a4707; background-color: #e8e8e8; font-size: 13px; font-weight: bold;">-F:</span> command tells <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">awk</span> to use the ” <span style="font-family: courier; color: #7a4707; background-color: #e8e8e8; font-size: 13px; font-weight: bold;">:</span> ” character as the delimiter). In the second field of this file, if you look at it, you may also encounter two other special characters: The ” <span style="font-family: courier; color: #7a4707; background-color: #e8e8e8; font-size: 13px; font-weight: bold;">*</span> ” character indicates that the account cannot be logged into, and the ” <span style="font-family: courier; color: #7a4707; background-color: #e8e8e8; font-size: 13px; font-weight: bold;">!!</span> ” characters also indicate that the account has a null password; this is ok because these types of accounts cannot login. In both cases, you can use <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">su</span> to become one of these accounts (provided they have a valid shell in <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/etc/passwd</span>).
</p>
<p>On <span class="caps">SVR4</span> <span class="caps">UNIX</span> systems, you can also determine what accounts have no password by using the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">logins</span> command like this:
</p>
<pre>
# logins -p
</pre>
<p>To accomplish something similar on <span class="caps">OS</span> X, you have to use the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">nidump</span> utility to extract the information from NetInfo first. This can be accomplished using:
</p>
<pre>
$ nidump passwd . | awk -F: '$2 == "" { print $1 }'
</pre>
<p>This command pulls the passwd information out of NetInfo and performs the same <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">awk</span> command since the format <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">nidump</span> uses is identical to that used by <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">passwd</span> and <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">shadow</span>. You can pull this information from other NetInfo domains as well; in the above example we are pulling the data from the local domain (indicated by the ” <span style="font-family: courier; color: #7a4707; background-color: #e8e8e8; font-size: 13px; font-weight: bold;">.</span> ” (dot) character). Unfortunately, this data is not protected from casual snooping; any user can obtain the encrypted passwords of other users by using <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">nidump</span> as it does not require root privilege to view (unlike systems using shadow accounts).
</p>
<h2><span class="mw-headline" id="Finding_Accounts_with_UID_0_.28aka_SuperUser.29">Finding Accounts with <span class="caps">UID</span> 0 (aka SuperUser)</span></h2>
<p>One means of obtaining (and keeping) elevated access by a cracker is to give themselves <span class="caps">UID</span> 0. This is the magic number for superuser powers on a system and does not need to necessarily be restricted to root. For instance, an attacker could obtain root access to a machine, change another account or add their own, and give it <span class="caps">UID</span> 0. This does not interfere with the real root account; you will simply have two accounts with equivalent superuser access. Detecting anomolies here can help you track down accounts with <span class="caps">UID</span> 0 and unless you made the change, any account other than root with <span class="caps">UID</span> 0 is suspect. Again, using <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">awk</span> you can determine if any accounts other than root have <span class="caps">UID</span> 0:
</p>
<pre>
# awk -F: '$3 == 0 { print $1 }' /etc/passwd
</pre>
<h2><span class="mw-headline" id="Viewing_Login_History">Viewing Login History</span></h2>
<p>Reviewing when accounts logged in is also an important step in observing any suspicious behaviour on your systems. This information is recorded to a binary database logfile called <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/log/wtmp</span>. This file cannot be viewed using a normal text editor as it’s not a plaintext file; it also should not be rotated as other log files because it retains roughly the same size at all times. <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">wtmp</span> takes care of itself and as new data is written to the file, old data is removed.
</p>
<p>To view a history of user logins, use the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">last</span> command, optionally specifying a username to look at specifically (the default is to show information on all accounts):
</p>
<pre>
# last joe
</pre>
<p>This will show when joe logged in; it will indicate what console or terminal they logged in at, the XFree86 display name if applicable, and the date/time of the login. By looking at this information, you can see if any anomolies appear; ie. accounts being logged in when an individual would normally be sleeping, or access outside of work hours, etc.
</p>
<p>To view the last login, some systems provide the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastlog</span> tool (most Linux systems do, <span class="caps">OS</span> X does not). <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastlog</span> displays pretty much the same information as <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">last</span>, but restricts the output to the absolute latest login. For instance:
</p>
<pre>
# lastlog -u joe
</pre>
<p>This command will display the last login for the user joe. By default, <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastlog</span> displays the last login for all users on the system. Another useful command is <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastb</span> which displays the last bad login attempt for users. However, most systems do not enable this by default. The log file used here is <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/log/btmp</span> which probably does not exist on the system. To create the file, execute as root:
</p>
<pre>
# touch /var/log/btmp
# chmod 640 /var/log/btmp
</pre>
<p>This will create the file and make it read/write only by the user root. Double-check the ownership and permissions of <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/log/wtmp</span> and make sure that <span style="font-family: courier; color: #891214; font-style: italic; font-size: 13px; font-weight: bold;">/var/log/btmp</span> has the same. In most cases, the file should be owned by user and group root. Once this file is created, the system will start to record bad login attempts to the file, and they can be viewed with the <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastb</span> command. To view the list of bad login attempts, use:
</p>
<pre>
# lastb joe
</pre>
<p>By default, <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastb</span> shows all of the bad login attempts; if you want to view the bad login attempts for a particular account, give <span style="font-family: courier; color: #2a2c7e; font-size: 13px; font-weight: bold;">lastb</span> the username to check, as shown above.
</p>
            







        </div>
    </div>
    </article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Copyright &copy; 2023 Vincent Danen
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://vdanen.github.io/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>