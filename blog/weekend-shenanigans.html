<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/custom.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://annvix.com/theme/css/fontawesome.min.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Vincent Danen" />

        <meta name="description" content="I’ve written two articles previously, first was moving Gitea from FreeBSD to Linux and the second was a followup on accessing TrueNAS shares from a nested VM. The first was a few weeks ago, the second a few days. I took a long weekend and also took advantage of …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="linux, truenas, fedora, plex, unifi, Linux, " />

<meta property="og:title" content="Weekend Shenanigans "/>
<meta property="og:url" content="https://annvix.com/blog/weekend-shenanigans" />
<meta property="og:description" content="I’ve written two articles previously, first was moving Gitea from FreeBSD to Linux and the second was a followup on accessing TrueNAS shares from a nested VM. The first was a few weeks ago, the second a few days. I took a long weekend and also took advantage of …" />
<meta property="og:site_name" content="Annvix" />
<meta property="og:article:author" content="Vincent Danen" />
<meta property="og:article:published_time" content="2025-12-02T07:37:00-07:00" />
<meta name="twitter:title" content="Weekend Shenanigans ">
<meta name="twitter:description" content="I’ve written two articles previously, first was moving Gitea from FreeBSD to Linux and the second was a followup on accessing TrueNAS shares from a nested VM. The first was a few weeks ago, the second a few days. I took a long weekend and also took advantage of …">

        <title>Weekend Shenanigans  · Annvix
</title>
        <link rel="shortcut icon" href="https://annvix.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://annvix.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://annvix.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://annvix.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://annvix.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://annvix.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://annvix.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://annvix.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://annvix.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://annvix.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://annvix.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://annvix.com/recent.atom" type="application/atom+xml" rel="alternate" title="Annvix - Full Atom Feed" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5JGVD90SKJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5JGVD90SKJ');
</script>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://annvix.com/"><span class=site-name>Annvix</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://annvix.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://annvix.com/categories">Categories</a></li>
                                <li ><a href="https://annvix.com/tags">Tags</a></li>
                                <li ><a href="https://annvix.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://annvix.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://annvix.com/blog/weekend-shenanigans">
                Weekend&nbsp;Shenanigans
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>I&#8217;ve written two articles previously, first was <a href="https://annvix.com/blog/moving-gitea-from-freebsd-to-linux">moving Gitea from FreeBSD to Linux</a> and the second was a followup on <a href="https://annvix.com/blog/accessing-truenas-shares-from-a-nested-vm">accessing TrueNAS shares from a nested <span class="caps">VM</span></a>.  The first was a few weeks ago, the second a few days.  I took a long weekend and also took advantage of some Black Friday sales to upgrade the drives in my TrueNAS box, some of which were 8 years old.  This should honestly be a series called &#8220;Readventure in sysadmining&#8221; as it&#8217;s turning out to be quite the adventure.  Home labs for the&nbsp;win!</p>
<p>I swapped out 6 <span class="caps">3TB</span> drives for 6 shiny new <span class="caps">6TB</span> drives thinking: hey, some of these are getting old in the tooth.  They&#8217;re likely to start failing soon, and I could save myself a few dollars in the&nbsp;process.</p>
<p>Got home, swapped and resilvered each drive (5x6TB in an <span class="caps">RAIDZ2</span> with one hot spare).  TrueNAS makes this ridiculously&nbsp;easy.</p>
<p>And then I found out that my Ubiquiti CloudKey Gen2 was having a hard time.  Some of you will know this&#8230; that little <em>whine</em> then <em>click</em> of a failing hard drive.  At first I thought it was my TrueNAS Core box, and then sadly realized it was the CloudKey with it&#8217;s little 2.5&#8221; drive.  So off I went to Best Buy to get an <span class="caps">SSD</span> to replace&nbsp;it.</p>
<p>Which didn&#8217;t&nbsp;work.</p>
<p>Turns out the CloudKey itself was pretty much dead, and nothing I did would restore it.  So the <span class="caps">SSD</span> was returned (thank you, Best Buy) as there was no longer a need for it.  Swapped it for a <span class="caps">1TB</span> NVMe <span class="caps">SSD</span> to stick in the TrueNAS box (as all the <span class="caps">SATA</span> connectors were used and the motherboard allowed for four NVMe SSDs).  Now two are in use: one for the boot drive, and another for all of the TrueNAS apps (containers) and VMs, on its own dedicated Stripe&nbsp;pool.</p>
<p>Moving the apps was as easy as telling it to move from one pool to another in the web <span class="caps">UI</span>.</p>
<p>Moving the VMs was a little more involved but easy enough.  Each VMs dataset must be moved from one pool to another, which is easily accomplished by finding the dataset involved (i.e. <code>Fedora-k9krs2</code>) and moving it from one pool (<code>storage</code> in my case) to another, which was named <code>apps</code>.  Within the <code>apps</code> dataset, another dataset named <code>VMs</code> was created so that all the VMs were nicely organized together.  Before doing this, ensure the <span class="caps">VM</span> is powered&nbsp;off.</p>
<div class="highlight"><pre><span></span>zfs<span class="w"> </span>snapshot<span class="w"> </span>-r<span class="w"> </span>storage/Fedora-k9krs2@migrate
zfs<span class="w"> </span>send<span class="w"> </span>storage/Fedora-k9krs2@migrate<span class="w"> </span><span class="p">|</span><span class="w"> </span>zfs<span class="w"> </span>receive<span class="w"> </span>apps/VMs/Fedora-k9krs2
</pre></div>


<p>Now edit the virtual machine&#8217;s disk device and change the dataset it was using, in my case from <code>storage/Fedora-k9krs2</code> to <code>apps/VMs/Fedora-k9krs2</code>.  Save and start.&nbsp;Easy!</p>
<p>Once the drives were upgraded, it was time to copy all of the Plex media from the old TrueNAS Core box to the TrueNAS Scale box with the new drives.  Exposing the Plex metadata and media files themselves via Samba to the virtual machine that was created for Plex using the <a href="https://linuxcapable.com/install-plex-media-server-on-fedora-linux/">wonderful tutorial</a> mentioned in a previous post worked like a champ.  View history and all settings retained!  Some work needed to be done to ensure that there were no FreeBSD binaries still hiding in there, and finally symlinking the <code>/var/lib/plexmediaserver/Library/Application Support/Plex Media Server</code> directory to the Samba share, so that all the metadata is stored on external to the <span class="caps">VM</span>.</p>
<p>All of this was being done waiting for the new CloudKey Gen 2 to arrive. Because the CloudKey runs my home network and my Unifi Protect (doorbell cameras and other cameras) and my last backup was 4 years ago, I was pretty nervous.  There was no way to get any data from the drive (it was more or less empty, yet through my panic trying to mount the Linux <span class="caps">RAID</span> (mdadm) drive, having retired my Fedora laptop last year, learning how to use <span class="caps">USB</span> passthrough in a TrueNAS <span class="caps">VM</span> was accomplished!).  My operating assumption at this point, based on everything researched, was that the network would need to be reconfigured from&nbsp;scratch.</p>
<p>But lo and behold, when it arrived and was powered up, and when I logged into it using my Ubiquiti account and <em>oh-my-gosh-my-prayers-were-heard</em> it told me there was an online backup from two weeks ago and would I like to restore it?  <em>Heck yeah I&nbsp;would!</em></p>
<p>And it worked, which was amazing and literally made my day.  No network/camera&nbsp;reconfiguration!</p>
<p>It may not sound like much but it was a pretty eventful few days.  It&#8217;s not often that I get back to my sysadmin roots beyond typical <span class="caps">OS</span> updates and such, so this was fun.  The next step, although I think I&#8217;ll wait a few weeks, is to see if the promise of updating TrueNAS from Core to Scale (aka FreeBSD to Linux) holds true.  That feels like some kind of amazing wizardry that will be interesting to&nbsp;see.</p>


             
 
                <p id="post-share-links">
    Share on:
      <a href="https://twitter.com/intent/tweet?text=Weekend%C2%A0Shenanigans&url=https%3A//annvix.com/blog/weekend-shenanigans&hashtags=linux,truenas,fedora,plex,unifi" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
 ❄       <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//annvix.com/blog/weekend-shenanigans&title=Weekend%C2%A0Shenanigans&summary=I%E2%80%99ve%20written%20two%20articles%20previously%2C%20first%20was%20moving%20Gitea%20from%20FreeBSD%20to%20Linux%20and%20the%20second%20was%20a%20followup%20on%20accessing%20TrueNAS%20shares%20from%20a%20nested%20VM.%20%20The%20first%20was%20a%20few%20weeks%20ago%2C%20the%20second%20a%20few%20days.%20%20I%20took%20a%20long%20weekend%20and%20also%20took%20advantage%20of%20%E2%80%A6&source=https%3A//annvix.com/blog/weekend-shenanigans" target="_blank" rel="nofollow noopener noreferrer" title="Share on LinkedIn">LinkedIn</a>

            
            







            <hr/>
<section>
    <h2>Related Posts</h2>
<ul class="related-posts-list">
<li><a href="https://annvix.com/blog/holiday-hacking" title="Holiday Hacking">Holiday Hacking</a></li>
<li><a href="https://annvix.com/blog/compiler-the-new-security-landscape" title="Compiler: The New Security Landscape">Compiler: The New Security Landscape</a></li>
<li><a href="https://annvix.com/blog/moving-gitea-from-freebsd-to-linux" title="Moving Gitea from FreeBSD to Linux">Moving Gitea from FreeBSD to Linux</a></li>
<li><a href="https://annvix.com/blog/accessing-truenas-shares-from-a-nested-vm" title="Accessing TrueNAS shares from a nested VM">Accessing TrueNAS shares from a nested VM</a></li>
<li><a href="https://annvix.com/blog/gitea-container-registry-with-podman" title="Gitea container registry with podman">Gitea container registry with podman</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://annvix.com/blog/accessing-truenas-shares-from-a-nested-vm" title="Previous: Accessing TrueNAS shares from a nested VM">Accessing TrueNAS shares from a nested VM</a></li>
                <li class="next-article"><a href="https://annvix.com/blog/gitea-container-registry-with-podman" title="Next: Gitea container registry with podman">Gitea container registry with podman</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2025-12-02T07:37:00-07:00">Dec 02, 2025</time>
            <h4>Category</h4>
            <a class="category-link" href="https://annvix.com/categories#linux-ref">Linux</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://annvix.com/tags#fedora-ref">fedora
                    <span class="superscript">17</span>
</a></li>
                <li><a href="https://annvix.com/tags#linux-ref">linux
                    <span class="superscript">22</span>
</a></li>
                <li><a href="https://annvix.com/tags#plex-ref">plex
                    <span class="superscript">3</span>
</a></li>
                <li><a href="https://annvix.com/tags#truenas-ref">truenas
                    <span class="superscript">7</span>
</a></li>
                <li><a href="https://annvix.com/tags#unifi-ref">unifi
                    <span class="superscript">1</span>
</a></li>
            </ul>
<h4>Stay in touch</h4>
<div id="sidebar-social-link">
    <a href="https://twitter.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://github.com/vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/vdanen/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://infosec.exchange/@vdanen" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mastodon" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%"/><path d="m409 290c-5 24-43 50-85 56-86 11-137-6-137-6 3 13-4 54 70 52 31 0 58-7 58-7l2 27c-51 24-107 15-140 6-67-17-79-90-81-162v-59c0-74 49-96 49-96 50-24 180-22 222 0 0 0 49 22 49 96 0 0 1 55-7 93" fill="#3088d4"/><path d="m358 202v91h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Copyright &copy; 2024 Vincent Danen
    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://annvix.com/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>